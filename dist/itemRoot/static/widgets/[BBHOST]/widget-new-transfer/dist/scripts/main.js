/* widget-new-transfer@v3.2.9 build with â™¥ by bb-lp-cli@v1.9.12 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("base"),require("core"),require("ui"),require("module-accounts"),require("module-contacts"),require("module-p2p"),require("module-payments"),require("module-transactions"),require("module-users")):"function"==typeof define&&define.amd?define(["base","core","ui","module-accounts","module-contacts","module-p2p","module-payments","module-transactions","module-users"],t):"object"==typeof exports?exports["widget-new-transfer"]=t(require("base"),require("core"),require("ui"),require("module-accounts"),require("module-contacts"),require("module-p2p"),require("module-payments"),require("module-transactions"),require("module-users")):e["widget-new-transfer"]=t(e.base,e.core,e.ui,e["module-accounts"],e["module-contacts"],e["module-p2p"],e["module-payments"],e["module-transactions"],e["module-users"])}(this,function(e,t,n,r,a,o,c,u,s){return function(e){function t(r){if(n[r])return n[r].exports;var a=n[r]={exports:{},id:r,loaded:!1};return e[r].call(a.exports,a,a.exports,t),a.loaded=!0,a.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,exports,t){e.exports=t(1)},function(e,exports,t){var n;(function(e){"use strict";n=function(require,exports,e){function n(e,t,n){t.setConfig({paymentsEndpoint:e.getPreference("paymentOrdersDataSrc")}),e&&e.model&&e.model.name&&n.publish("cxp.item.loaded",{id:e.model.name})}n.$inject=["lpWidget","lpPayments","lpCoreBus"],e.name="widgets-new-transfer";var r=t(3),a=t(4),o=t(5),c=t(6),u=t(7),s=t(8),i=t(9),d=t(10),l=t(11),p=[a.name,o.name,c.name,i.name,s.name,d.name,u.name,l.name];e.exports=r.createModule(e.name,p).factory(t(12)).controller(t(13)).directive(t(14)).run(n)}.call(exports,t,exports,e),!(void 0!==n&&(e.exports=n))}).call(exports,t(2)(e))},function(e,exports){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children=[],e.webpackPolyfill=1),e}},function(t,exports){t.exports=e},function(e,exports){e.exports=t},function(e,exports){e.exports=n},function(e,exports){e.exports=r},function(e,exports){e.exports=a},function(e,exports){e.exports=o},function(e,exports){e.exports=c},function(e,exports){e.exports=u},function(e,exports){e.exports=s},function(e,exports,t){var n;n=function(require,exports,e){"use strict";var n=t(3);exports.formDataPersistence=function(){function e(){var e,t,r=(new Date).getTime().toString();try{return(e=window.localStorage).setItem(r,r),t=e.getItem(r)===r,e.removeItem(r),t&&e}catch(a){n.log.warn(a)}}var t=function(){};return t.prototype.saveFormData=function(t,n){if(e()){var r=JSON.stringify(n);window.sessionStorage.setItem(t,r)}},t.prototype.removeFormData=function(t){e()&&window.sessionStorage.removeItem(t)},t.prototype.getFormData=function(e){try{var t=JSON.parse(window.sessionStorage.getItem(e))}catch(r){n.log.warn("Can't parse form's stored storage data.")}var a=function o(e){for(var t in e)if(e.hasOwnProperty(t)){if(t.toLowerCase().indexOf("date")>-1&&"boolean"!=typeof e[t]){var n=new Date(e[t]);isNaN(n.getTime())||(e[t]=n)}e[t]instanceof Object&&o(e[t])}return e};return a(t),t},t.prototype.isFormSaved=function(e){var t=window.sessionStorage.getItem(e);return null!==t},{getInstance:function(){return new t}}}}.call(exports,t,exports,e),!(void 0!==n&&(e.exports=n))},function(e,exports,t){var n;n=function(require,exports,e){"use strict";function t(e){e.$$phase||e.$apply()}function n(){var e=(new Date).getTime(),t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:7&n|8).toString(16)});return t}var r=window.jQuery;exports.NewTransferController=function(e,a,o,c,u,s,i,d,l,p,m,y,f,g,h,O,v,b,T,w){e.errors={};var C=m,M=O.api(),S=C.getPreference("autosaveContactsPreference"),P="new-transfer-form",E={RECURRING:"RECURRING",NON_RECURRING:"NON_RECURRING"},x=function(){return!e.contactsModel.findByName(e.paymentOrder.counterpartyName)&&(!e.paymentOrder.selectedCounter||e.paymentOrder.selectedCounter.name!==e.paymentOrder.counterpartyName||e.paymentOrder.selectedCounter.account!==e.paymentOrder.counterpartyIban)},D=function(){var t={name:e.paymentOrder.counterpartyName};e.paymentOrder.type===e.poTypeEnum.bank?t.account=e.usTransfer?e.paymentOrder.counterpartyAccount:e.paymentOrder.counterpartyIban:e.paymentOrder.type===e.poTypeEnum.p2pEmail&&(t.email=e.paymentOrder.counterpartyEmail),e.contactsModel.currentContact=t,e.contactsModel.createCounterParty(!0),s.publish("launchpad.contacts.load")},A=function(){var t=!!e.paymentOrder&&e.paymentOrder.isScheduledTransfer;e.paymentOrder={update:!1,uuid:n(),dateAllOptions:[{id:"today",label:"Transfer today"},{id:"date",label:"Scheduled transfer"}],dateOptions:"today",isScheduledTransfer:t,scheduledTransfer:{frequency:"",every:1,intervals:[],startDate:new Date,endDate:new Date,timesToRepeat:1},urgentTransfer:!1,scheduleDate:new Date,isOpenDate:!1,instructedCurrency:"",counterpartyIban:"",counterpartyAccount:"",counterpartyEmail:"",counterpartyAddress:"",instructedAmount:"",paymentReference:"",paymentDescription:"",counterpartyName:"",date:"",saveContact:""!==S&&u.parseBoolean(S),type:e.poTypeEnum.bank,dirty:!1}},N=function(){for(var t in e.activeTransferTab)e.activeTransferTab.hasOwnProperty(t)&&(e.activeTransferTab[t]=!1);var n=!1;for(var r in e.poTypeEnum)e.poTypeEnum.hasOwnProperty(r)&&e.poTypeEnum[r]===e.paymentOrder.type&&(e.activeTransferTab[r]=!0,n=!0);n||(e.activeTransferTab.bank=!0)},I=function(){e.$broadcast("reset",{})},F=function(){e.paymentOrderForm.counterpartyIban&&e.paymentOrder.type===e.poTypeEnum.bank&&e.paymentOrderForm.counterpartyIban.$setValidity("notEqual",e.notEqualAccounts())},R=function(t){return t.type=e.poTypeEnum.bank,e.usTransfer?(t.counterpartyAccount=e.paymentOrder.counterpartyAccount,""!==e.paymentOrder.paymentDescription&&(t.paymentDescription=e.paymentOrder.paymentDescription)):(t.counterpartyIban=e.paymentOrder.counterpartyIban,""===e.paymentOrder.paymentReference&&""!==e.paymentOrder.paymentDescription?t.paymentDescription=e.paymentOrder.paymentDescription:""===e.paymentOrder.paymentDescription&&""!==e.paymentOrder.paymentReference&&(t.paymentReference=e.paymentOrder.paymentReference)),e.paymentOrder.isScheduledTransfer?(t.scheduledTransfer={},t.scheduledTransfer.frequency=e.paymentOrder.scheduledTransfer.frequency,t.scheduledTransfer.every=e.paymentOrder.scheduledTransfer.every,t.scheduledTransfer.intervals=e.paymentOrder.scheduledTransfer.intervals.join(","),t.scheduledTransfer.startDate=+new Date(e.paymentOrder.scheduledTransfer.startDate),t.scheduledTransfer.endDate=+new Date(e.paymentOrder.scheduledTransfer.endDate),t.paymentMode=E.RECURRING):(t.onDate=+new Date(e.paymentOrder.scheduleDate),t.paymentMode=E.NON_RECURRING,t.urgentTransfer=e.paymentOrder.urgentTransfer),t},$=function(t){return t.type=e.poTypeEnum.p2pEmail,t.onDate=+new Date(e.paymentOrder.scheduleDate),t.paymentMode=E.NON_RECURRING,t.counterpartyEmail=e.paymentOrder.counterpartyEmail,t},U=function(t){return t.type=e.poTypeEnum.p2pAddress,t.onDate=+new Date(e.paymentOrder.scheduleDate),t.paymentMode=E.NON_RECURRING,t.counterpartyAddress=e.paymentOrder.counterpartyAddress,t},q=function(){e.mediaDir=u.getWidgetBaseUrl(C)+"/media",e.todaysDate=new Date,e.hideFooter=u.parseBoolean(C.getPreference("hideFooter")),e.poTypeEnum=h,e.p2pService=g.api("enroll-service").setConfig({url:u.resolvePortalPlaceholders(m.getPreference("p2pEnrollmentEndpoint"))}),e.p2pService.getAll().then(function(t){e.userEnrolledForP2P=!0},function(t){s.subscribe("launchpad-retail.userP2PEnrolled",function(t){e.userEnrolledForP2P=t.enrolled}),404===t.status&&(e.userEnrolledForP2P=!1,e.p2pUserEnrollment={email:"",mobile:"",receivingAccountNumber:"",customerId:""})}),e.urgentTranfer=!1,e.locale=C.getPreference("locale"),e.usTransfer="en-US"===e.locale,e.title=C.getPreference("title"),e.accountsTopBalance=C.getPreferenceFromParents("defaultBalanceView")||"current",e.disableCurrencySelection=C.getPreference("disableCurrencySelection"),e.modalShown=!1,e.exchangeRateModalShown=!1,e.ibanModalShown=!1,e.routingModalShown=!1,e.templates={saveContacts:"templates/save-contacts.html",urgentTransfer:"templates/urgent-transfer.html",exchangeRate:"templates/exchange-rate.html",iban:"templates/iban.html",routingAndAccount:"templates/routing-and-account-number.html"},e.accountsModel=i,e.accountsModel.setConfig({accountsEndpoint:C.getPreference("accountsDataSrc")}),e.paymentOrderModel=M.createModel(),e.dateOptions={"show-button-bar":!1,"show-weeks":!1},e.selectAccount=function(n){e.accountsModel.accounts&&(r.each(e.accountsModel.accounts,function(t,r){n.accountId===r.id&&(e.accountsModel.selected=r)}),t(e))};var n=e.accountsModel.load();if(n.then(function(){if(!u.parseBoolean(C.getPreference("forceAccountSelection"))){if(!e.accountsModel.selected&&e.accountsModel.accounts&&e.accountsModel.accounts.length>0){var t=C.getPreferenceFromParents("defaultAccount");if(t&&(e.accountsModel.selected=e.accountsModel.findByAccountNumber(t)),e.accountsModel.selected)return;return T.read().then(function(t){e.accountsModel.selected=e.accountsModel.accounts.filter(function(e){return e.identifier===t.data.defaultAccount})[0]||e.accountsModel.accounts[0]})}s.subscribe("launchpad-retail.accountSelected",e.selectAccount)}})["catch"](function(){e.accountsModel.error="accountsLoadFailed"}),w.get(u.resolvePortalPlaceholders(C.getPreference("profileDetailsEndpoint"))).then(function(t){e.userDetails=t}),e.currencyModel=l.api(),l.setConfig({defaultCurrencyEndpoint:m.getPreference("defaultCurrencyEndpoint"),currencyListEndpoint:m.getPreference("currencyListEndpoint")}),e.currencyModel.loadDefaultCurrency().then(function(t){e.currencyModel.configureDefaultCurrency(t),e.paymentOrder.instructedCurrency=""===e.paymentOrder.instructedCurrency?e.currencyModel.defaultCurrency.currency_code:e.paymentOrder.instructedCurrency,e.currencyModel.loadOtherCurrencies().then(function(){var t=""===e.paymentOrder.instructedCurrency?e.currencyModel.defaultCurrency.currency_code:e.paymentOrder.instructedCurrency;e.currencyModel.selectCurrency(t)})}),e.contactsModel=new d({contacts:u.resolvePortalPlaceholders(C.getPreference("contactListDataSrc")),contactData:u.resolvePortalPlaceholders(C.getPreference("contactDataSrc")),contactDetails:u.resolvePortalPlaceholders(C.getPreference("contactDetailsDataSrc"))}),e.contactsModel.loadContacts(),e.ibanModel=p.getInstance({countryListEndpoint:C.getPreference("ibanDataSrc"),enableCountrySearch:u.parseBoolean(C.getPreference("enableIbanCountrySearch"))}),e.ibanModel.loadCountryList().then(function(t){e.ibanModel.validate()}),A(),e.toggleTabs={oneTime:!e.paymentOrder.isScheduledTransfer,scheduled:!!e.paymentOrder.isScheduledTransfer},e.activeTransferTab={bank:!0,p2pEmail:!1,p2pAddress:!1},e.persistenceManager=f.getInstance(),e.persistenceManager.isFormSaved(P)){var a=e.persistenceManager.getFormData(P),o=["uuid","scheduleDate","update"];for(var y in a)a.hasOwnProperty(y)&&o.indexOf(y)===-1&&(e.paymentOrder[y]=a[y]);N()}C.addEventListener("PerspectiveModified",function(t){"Minimized"!==t.newValue&&"Widget"!==t.newValue||e.hideAllModals()}),e.$watch("paymentOrder",function(t,n){t!==n&&(e.persistenceManager.saveFormData(P,e.paymentOrder),t&&t.type!==e.poTypeEnum.bank&&e.setScheduledTransfer("one-time"))},!0),s.subscribe("launchpad-retail.requestMoneyTransfer.setTab",function(t){t.tab&&(e.paymentOrder.type=t.tab,N())}),s.subscribe("lpMoneyTransfer.update",function(t){e.paymentOrder=t,e.currencyModel.selectCurrency(e.paymentOrder.instructedCurrency),c(function(){e.selectAccount(t)})}),t(e)};e.openCalendar=function(t){"click"!==t.type&&32!==t.which&&13!==t.which||(t.preventDefault(),t.stopPropagation(),e.paymentOrder.isOpenDate=!0)},e.setPaymentOrderType=function(t){e.paymentOrder.type=t},e.submitForm=function(t){var n;t&&t.preventDefault&&t.preventDefault(),e.persistenceManager.removeFormData(P),F();var r=!0;if(e.paymentOrderForm.submitted=!0,e.paymentOrderForm.$invalid)return e.$broadcast("lp.retail.new-transfer.errors"),!1;var a=M.createModel(),o=e.accountsModel.selected;switch(a.uuid=e.paymentOrder.uuid,a.counterpartyName=e.paymentOrder.counterpartyName,a.instructedAmount=e.paymentOrder.instructedAmount,a.instructedCurrency=e.paymentOrder.instructedCurrency,""===a.instructedCurrency&&(a.instructedCurrency=o.currency),a.accountId=o.id,a.accountName=o.alias,e.paymentOrder.type){case e.poTypeEnum.bank:a=R(a);break;case e.poTypeEnum.p2pEmail:e.userEnrolledForP2P||e.p2pService.enroll({email:e.p2pUserEnrollment.email,accountNumber:e.p2pUserEnrollment.receivingAccountNumber}).then(function(e){s.publish("launchpad-retail.userP2PEnrolled",{enrolled:!0}),s.publish("launchpad-retail.p2pEnrollmentComplete",{verified:!0})},function(t){e.p2pService.error="An error occurred while connecting to the P2P Service",r=!1}),a=$(a);break;case e.poTypeEnum.p2pAddress:e.userEnrolledForP2P||e.p2pService.enroll({email:e.p2pUserEnrollment.email,accountNumber:e.p2pUserEnrollment.receivingAccountNumber}).then(function(e){},function(t){e.p2pService.error="An error occurred while connecting to the P2P Service",r=!1}),a=U(a);break;default:a=R(a)}e.paymentOrder.saveContact&&x()&&D(),r&&(n=a.createOrder(a),n.then(function(t){b.trigger("newPaymentOrderInitiated"),s.publish("Launcher:openWidget",{widgetName:"review-transfers-v1"}),s.publish("launchpad-retail.paymentOrderInitiated",{paymentId:a.id}),e.resetForm()},function(t){e.errors.updateServerError=!0,c(function(){e.errors.updateServerError=!1},5e3),console.log("Server error: "+t.statusText)}))},e.hideFooter&&s.subscribe("transfer:submit",e.submitForm),e.onSaveContactsChange=function(){""===S&&e.paymentOrder.saveContact&&e.toggleModal()},e.setContactPreference=function(t){S=!!t,C.model.setPreference("autosaveContactsPreference",""+S),C.model.save(),e.toggleModal()},e.showContactsInfo=function(){e.showContactsOptions=!1,e.toggleModal()},e.toggleSaveToContactsModal=function(){e.showContactsOptions=!e.showContactsOptions},e.toggleAutosuggest=function(){r(C.body).find("[name=counterpartyName]").trigger("toggle.autosuggest")},e.cancelForm=function(){s.publish("launchpad-retail.closeActivePanel")},e.resetForm=function(){A(),I(),N(),e.currencyModel.selectCurrency(e.currencyModel.defaultCurrency.currency_code),e.paymentOrderForm.submitted=!1,e.paymentOrderForm.$setPristine(),e.persistenceManager.removeFormData(P)},e.resetCounterparty=function(){e.$apply(function(){e.paymentOrder.counterpartyIban=""})},e.updateCounterparty=function(t){return null===t||void 0===t?(e.paymentOrder.counterpartyIban="",e.paymentOrder.type===e.poTypeEnum.bank?e.usTransfer?e.paymentOrder.counterpartyAccount="":e.paymentOrder.counterpartyIban="":e.paymentOrder.type===e.poTypeEnum.p2pEmail&&(e.paymentOrder.counterpartyEmail=""),void e.paymentOrderForm.$setDirty()):(e.paymentOrder.selectedCounter={name:e.paymentOrder.counterpartyName,account:t.account},e.paymentOrder.type=t.type,N(),e.paymentOrder.type===e.poTypeEnum.bank?e.usTransfer?e.paymentOrder.counterpartyAccount=t.account:e.paymentOrder.counterpartyIban=t.account:e.paymentOrder.type===e.poTypeEnum.p2pEmail&&(e.paymentOrder.counterpartyEmail=t.account),void e.paymentOrderForm.$setDirty())},e.notEqualAccounts=function(){return!!e.accountsModel.selected&&e.accountsModel.selected.iban!==e.paymentOrder.counterpartyIban},e.onAccountChange=function(){F()},e.toggleModal=function(){e.showContactsOptions=!e.showContactsOptions},e.toggleExchangeRateModal=function(){e.exchangeRateModalShown=!e.exchangeRateModalShown},e.toggleSaveContactDetailsModal=function(){e.modalShown=!e.modalShown},e.toggleIbanModal=function(){e.ibanModalShown=!e.ibanModalShown},e.toggleRoutingNumberModal=function(){e.routingModalShown=!e.routingModalShown},e.hideAllModals=function(){e.urgentTransferModalShown=!1,e.exchangeRateModalShown=!1,e.ibanModalShown=!1,e.modalShown=!1},e.toggleUrgentTransferModal=function(){e.urgentTransferModalShown=!e.urgentTransferModalShown},e.setScheduledTransfer=function(t){"scheduled"===t?(e.paymentOrder.isScheduledTransfer=!0,e.toggleTabs.oneTime=!1,e.toggleTabs.scheduled=!0):"one-time"===t&&(e.paymentOrder.isScheduledTransfer=!1,e.toggleTabs.oneTime=!0,e.toggleTabs.scheduled=!1)},e.$on("reset",function(){e.paymentOrder.isScheduledTransfer=!1,e.toggleTabs.oneTime=!0,e.toggleTabs.scheduled=!1}),C.addEventListener("preferencesSaved",function(){C.refreshHTML(),q()}),q()},exports.NewTransferController.$inject=["$scope","$rootScope","$rootElement","$timeout","lpCoreUtils","lpCoreBus","AccountsModel","ContactsModel","lpTransactionsCurrency","IbanModel","lpWidget","customerId","formDataPersistence","lpP2P","transferTypes","lpPayments","lpUIResponsive","lpCoreUpdate","lpUsersPreference","lpUserDetails"]}.call(exports,t,exports,e),!(void 0!==n&&(e.exports=n))},function(e,exports,t){var n;n=function(require,exports,e){"use strict";var t=window.jQuery;exports.lpTransactionUpdateLayout=function(e,n){return{restrict:"A",scope:{paymentOrder:"=lpTransactionUpdateLayout"},link:function(r,a,o,c){var u=t(a[0]).closest(".lp-launcher-area"),s=u.find(".close"),i=u.find(".widget-title span"),d=i.text();r.$watch("paymentOrder.update",function(e){n(e?function(){i.text("Update Transfer")}:function(){i.text(d)})}),s.click(function(){r.paymentOrder.update=!1}),e.subscribe("launchpad-retail.closeActivePanel",function(){r.paymentOrder.update=!1})}}},exports.lpTransactionUpdateLayout.$inject=["lpCoreBus","$timeout"],exports.lpFutureTime=function(){return{require:"?ngModel",link:function(e,t,n,r){var a=new Date;a.setDate(a.getDate()-1),a=a.getTime(),r.$parsers.unshift(function(e){var t;return e?(t=Date.parse(e),isNaN(t)||t<0?(r.$setValidity("lpFutureTime",!1),e):t<=a?(r.$setValidity("lpFutureTime",!1),e):(r.$setValidity("lpFutureTime",!0),e)):(r.$setValidity("lpFutureTime",!0),null)})}}},exports.lpSmartsuggest=function(e,n,r,a){return{restrict:"A",scope:{lpSmartsuggestSelect:"&",lpSmartsuggestClear:"&",contacts:"=lpContacts",accounts:"=lpAccounts",model:"=ngModel"},link:function(n,o,c){var u=new r({showTitles:!0});u.addSuggester({data:[],suggest:r.builtIn.getContactSuggestions}),n.$watch("accounts",function(e){u.addSuggester({data:e,suggest:r.builtIn.getAccountSuggestions,type:r.types.ACCOUNT,options:{showAll:!0}})}),n.$watch("contacts",function(t){e.isArray(t)&&u.addSuggester({data:t,suggest:r.builtIn.getContactSuggestions,type:r.types.CONTACT,options:{showAll:!0}})});var s=new a({locale:"en-US"});n.$watch("model",function(){n.$eval(c.ngModel+" = model")}),n.$watch(c.ngModel,function(e){n.model=e}),t(o).autosuggest({lookup:function(e){var t=u.getSuggestions(e);return t=t.map(function(e){var t,n=s.format(e);return t=e.contact?e.contact.name:2===n.length?n[0]+" to "+n[1]:n[0],{data:e,value:t}})},onSelect:function(e){var t,a;if(e.data.type===r.types.TITLE)return!1;switch(e.data.type){case r.types.CONTACT:a=e.data.contact.name,t=e.data.contact.account;break;case r.types.ACCOUNT:a=e.data.account.name,t=e.data.account.iban}return n.model=a,n.lpSmartsuggestSelect({account:t}),!1},onClear:function(){n.lpSmartsuggestClear()},formatResult:function(e){return s.getSuggestionHtml(e.data)},autoSelectFirst:!1,minChars:0})}}},exports.lpSmartsuggest.$inject=["lpCoreUtils","ContactsModel","SmartSuggestEngine","SmartSuggestFormatter"]}.call(exports,t,exports,e),!(void 0!==n&&(e.exports=n))}])});
//# sourceMappingURL=main.js.map