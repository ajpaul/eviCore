/* Build with bb-lp-cli @ v1.2.1 */
!function(e,o){"object"==typeof exports&&"object"==typeof module?module.exports=o(require("base"),require("core"),require("ui"),require("module-accounts"),require("module-users"),require("module-p2p")):"function"==typeof define&&define.amd?define(["base","core","ui","module-accounts","module-users","module-p2p"],o):"object"==typeof exports?exports["widget-p2p-enrollment"]=o(require("base"),require("core"),require("ui"),require("module-accounts"),require("module-users"),require("module-p2p")):e["widget-p2p-enrollment"]=o(e.base,e.core,e.ui,e["module-accounts"],e["module-users"],e["module-p2p"])}(this,function(e,o,r,t,n,i){return function(e){function o(t){if(r[t])return r[t].exports;var n=r[t]={exports:{},id:t,loaded:!1};return e[t].call(n.exports,n,n.exports,o),n.loaded=!0,n.exports}var r={};return o.m=e,o.c=r,o.p="/_karma_webpack_//",o(0)}([function(e,o,r){var t;(function(e){t=function(require,e,o){"use strict";function t(){}o.name="widget-p2p-enrollment";var n=r(2),i=r(3),c=r(4),u=r(5),l=r(6),s=r(7),a=[i.name,c.name,u.name,l.name,s.name];o.exports=n.createModule(o.name,a).controller(r(8)).directive(r(9)).run(t)}.call(o,r,o,e),!(void 0!==t&&(e.exports=t))}).call(o,r(1)(e))},function(e,o){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children=[],e.webpackPolyfill=1),e}},function(o,r){o.exports=e},function(e,r){e.exports=o},function(e,o){e.exports=r},function(e,o){e.exports=t},function(e,o){e.exports=n},function(e,o){e.exports=i},function(e,o,r){var t;t=function(require,e,o){"use strict";e.P2PEnrollmentController=function(e,o,r,t,n,i,c){function u(){return e.options.email.valid&&e.terms.doesAgreeWithTerms?void e.p2pService.enroll({email:e.options.email.value,accountNumber:e.accountsModel.findById(e.options.depositAccount.value).identifier}).then(function(o){201===o.status&&(e.wizardNextStep(),n.publish("launchpad-retail.userP2PEnrolled",{enrolled:!0,enrollment:{account:e.accountsModel.findById(e.options.depositAccount.value),email:e.options.email}}))},function(){e.errorOccurred=!0,e.enrollmentError=!0}):void(e.errorOccurred=!0)}function l(){e.p2pService.error=!1,e.p2pService.verifyCode(e.options.email.value,e.verification.code).then(function(o){200===o.status&&(e.wizardNextStep(),n.publish("launchpad-retail.userP2PVerified",{verified:!0}))},function(o){409===o.status?(e.errorOccurred=!0,e.verification.error=!0):e.p2pService.error=!0})}var s=function(){e.errorOccurred=!1,e.p2pService=t.api("enroll-service").setConfig({url:i.resolvePortalPlaceholders(o.getPreference("p2pEnrollmentEndpoint"))}),e.p2pService.getAll().then(function(o){e.userEnrolled=!0},function(o){e.userEnrolled=!1,404!==o.status&&(e.errorOccurred=!1)}),e.options={email:{value:"",valid:!1},depositAccount:{value:"",options:[]}};var n=i.resolvePortalPlaceholders(o.getPreference("saveUrl"));c.get(n).then(function(o){e.options.email.value=o.emailAddress===[]?"":o.emailAddress,e.validateEmail(e.options.email.value)}),e.accountsModel=r,e.accountsModel.setConfig({accountsEndpoint:o.getPreference("accountsDataSrc")}),e.accountsModel.load().then(function(){e.options.depositAccount.options=e.accountsModel.accounts,e.options.depositAccount.value=e.accountsModel.accounts[0].id}),e.verification={code:"",error:!1},e.terms={doesAgreeWithTerms:!1}};e.validateEmail=function(o){e.errorOccurred=!1,e.options.email.valid=i.isValidEmail(o)},e.toNextStep=function(o){o.preventDefault(),o.stopPropagation(),e.errorOccurred=!1,1===e.getActiveWizardStep()?u():2===e.getActiveWizardStep()?l():3===e.getActiveWizardStep()&&e.openP2PTransfers()},e.openP2PTransfers=function(){n.publish("launchpad-retail.p2pEnrollmentComplete",{verified:!0}),n.publish("launchpad-retail.openP2PTransactions")},e.$watch("terms.doesAgreeWithTerms",function(o,r){o&&e.options.email.valid&&(e.errorOccurred=!1)}),s()},e.P2PEnrollmentController.$inject=["$scope","lpWidget","AccountsModel","lpP2P","lpCoreBus","lpCoreUtils","lpUserDetails"]}.call(o,r,o,e),!(void 0!==t&&(e.exports=t))},function(e,o,r){var t;t=function(require,e){"use strict";e.stepFocus=function(){return{scope:{step:"=stepFocus"},link:function(e,o){e.$watch("step",function(e){2===e&&o.focus()})}}}}.call(o,r,o,e),!(void 0!==t&&(e.exports=t))}])});