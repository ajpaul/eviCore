/* widget-external-accounts@v2.1.10 build with â™¥ by bb-lp-cli@v1.9.10 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("base"),require("ui"),require("core"),require("module-accounts"),require("jquery")):"function"==typeof define&&define.amd?define(["base","ui","core","module-accounts","jquery"],t):"object"==typeof exports?exports["widget-external-accounts"]=t(require("base"),require("ui"),require("core"),require("module-accounts"),require("jquery")):e["widget-external-accounts"]=t(e.base,e.ui,e.core,e["module-accounts"],e.jquery)}(this,function(e,t,n,i,r){return function(e){function t(i){if(n[i])return n[i].exports;var r=n[i]={exports:{},id:i,loaded:!1};return e[i].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,exports,t){e.exports=t(1)},function(e,exports,t){var n;(function(e){"use strict";n=function(require,exports,e){function n(e,t){e&&e.model&&e.model.name&&t.publish("cxp.item.loaded",{id:e.model.name})}n.$inject=["lpWidget","lpCoreBus"],e.name="widgets-external-accounts";var i=t(3),r=t(4),o=t(5),s=t(6),c=[o.name,r.name,s.name];e.exports=i.createModule(e.name,c).factory(t(7)).controller(t(8)).directive(t(9)).run(n)}.call(exports,t,exports,e),!(void 0!==n&&(e.exports=n))}).call(exports,t(2)(e))},function(e,exports){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children=[],e.webpackPolyfill=1),e}},function(t,exports){t.exports=e},function(e,exports){e.exports=t},function(e,exports){e.exports=n},function(e,exports){e.exports=i},function(e,exports,t){var n;n=function(require,exports,e){"use strict";exports.FinancialInstituteModel=function(e,t,n){var i=function(e){var i=this;i.enableGrouping=e.enableGrouping,e.financialInstitutesEndpoint=n.resolvePortalPlaceholders(e.financialInstitutesEndpoint),i.financialInstitutesService=t(e.financialInstitutesEndpoint),e.membershipRequestsEndpoint=n.resolvePortalPlaceholders(e.membershipRequestsEndpoint),i.membershipRequestsService=t(e.membershipRequestsEndpoint),i.selected={},i.selectedMembership={},i.financialInstitutes=[],i.membershipRequests=[],i.errors=[],i.warnings=[]};return i.prototype.searchFinancialInstitutes=function(e,t){var n=this;e.search="search";var i=n.financialInstitutesService.query(e).$promise;return i.then(function(e){if(t)for(var i=0;i<e.length;i++)n.financialInstitutes.push(e[i]);else n.financialInstitutes=e},function(e){n.addError({captionCode:"badConnection"})}),i},i.prototype.setSelected=function(e){var t=this;t.selected=e},i.prototype.loadMembershipRequests=function(){var e=this,t=e.membershipRequestsService.query().$promise;return t.then(function(t){e.membershipRequests=t},function(){e.addError({captionCode:"badConnection"})}),t},i.prototype.loadMembershipRequestByID=function(e){var t=this,n=t.membershipRequestsService.get({id:e}).$promise;return n.then(function(e){t.selectedMembership=e},function(){t.addError({captionCode:"badConnection"})}),n},i.prototype.getRequiredCredentials=function(){var e=this,t={id:e.selected.id,credentials:"credentials"},n=e.financialInstitutesService.query(t).$promise;return n.then(function(t){e.selected.requiredUserCredentials=t},function(t){e.addError({captionCode:"badConnection"})}),n},i.prototype.createMembershipRequest=function(e){var t=this,n=t.membershipRequestsService,i=new n;i.institutionId=e.id,i.credentials=[];for(var r=0;r<e.requiredUserCredentials.length;r++){var o={};o.credentialId=e.requiredUserCredentials[r].id,o.value=e.requiredUserCredentials[r].fieldValue,i.credentials.push(o)}var s=i.$save();return s.then(function(e){t.selectedMembership=e},function(){t.addError({captionCode:"invalidCredentials"})}),s},i.prototype.updateMembershipRequest=function(e){var t=this,n=t.membershipRequestsService,i=new n;i.institutionId=e.institutionId,i.credentials=[];for(var r=0;r<t.selected.requiredUserCredentials.length;r++){var o={};o.credentialId=t.selected.requiredUserCredentials[r].id,o.value=t.selected.requiredUserCredentials[r].fieldValue,i.credentials.push(o)}var s=i.$save({id:e.id,credentials:"credentials"});return s.then(function(e){t.selectedMembership=e},function(e){401===e.status?t.addError({captionCode:"invalidCredentials"}):t.addError({captionCode:"badConnection"})}),s},i.prototype.addError=function(e){for(var t=this,n=!1,i=0;i<t.errors.length;i++)t.errors[i].captionCode===e.captionCode&&(n=!0);n||t.errors.push(e)},i.prototype.addWarning=function(e){for(var t=this,n=!1,i=0;i<t.warnings.length;i++)t.warnings[i].captionCode===e.captionCode&&(n=!0);n||t.warnings.push(e)},i.prototype.clearErrors=function(){var e=this;e.errors=[]},i.prototype.clearWarnings=function(){var e=this;e.warnings=[]},{getInstance:function(e){return new i(e)}}},exports.FinancialInstituteModel.$inject=["httpService","$resource","lpCoreUtils"]}.call(exports,t,exports,e),!(void 0!==n&&(e.exports=n))},function(e,exports,t){var n;n=function(require,exports,e){"use strict";exports.ExternalAccountsController=function(e,t,n,i,r,o,s){var c=function(){e.fiModel=i.getInstance({financialInstitutesEndpoint:t.getPreference("financialInstitutionsSrc"),membershipRequestsEndpoint:t.getPreference("membershipRequestsSrc")}),e.partialsDir=o.getWidgetBaseUrl(t)+"/partials/",e.increment=parseInt(t.getPreference("amountToLoad"),10)||5,e.searchIndex=1,e.typeFilters={all:{label:"All",code:"",selected:!0},loan:{label:"Loans",code:"LOAN",selected:!1},"credit-cards":{label:"Credit Cards",code:"CREDIT_CARD",selected:!1},checking:{label:"Checking/Savings",code:"CHECKING,SAVINGS",selected:!1}},e.search={name:"",typeFilter:""},e.contextLabel="All",r.loadMessages(t,e.locale).success(function(t){e.messages=t.messages}),e.fiModel.isConnecting=!0,e.fiModel.searchFinancialInstitutes({f:e.searchIndex,l:e.increment,name:"",accountTypes:[]}).then(function(){e.searchIndex=e.searchIndex+e.increment})["finally"](function(){e.fiModel.isConnecting=!1})};e.restartWizard=function(){e.reset(),e.goToWizardStep(1)},e.reset=function(){e.fiModel.isConnecting=!1,e.fiModel.selectedMembership={},e.fiModel.clearErrors(),e.fiModel.clearWarnings()},e.loadAccounts=function(){e.reset(),n(function(){},2e3)},e.close=function(){s.publish("launchpad-retail.closeActivePanel")},c()},exports.ExternalAccountsController.$inject=["$scope","lpWidget","$timeout","FinancialInstituteModel","i18nUtils","lpCoreUtils","lpCoreBus"],exports.FinancialInstitutionListController=function(e,t,n,i){e.noMoreFIs=!1,e.selectFI=function(t,n){if(13===n.which||"click"===n.type){e.fiModel.setSelected(t),e.fiModel.isConnecting=!0;var i=e.fiModel.getRequiredCredentials();i.then(function(t){for(var n,i=0;i<e.fiModel.selected.requiredUserCredentials.length;i++)n=e.fiModel.selected.requiredUserCredentials[i],n.fieldValue="";e.fiModel.isConnecting=!1,e.wizardNextStep()},function(){e.fiModel.isConnecting=!1})}},e.searchForFinancialInstitute=function(t){return e.fiModel.isConnecting=!0,e.fiModel.searchFinancialInstitutes({f:e.searchIndex,l:e.increment,name:e.search.name,accountTypes:e.search.typeFilter},t).then(function(t){e.fiModel.isConnecting=!1,t.length<e.increment?e.noMoreFIs=!0:e.searchIndex=e.searchIndex+e.increment},function(){e.fiModel.isConnecting=!1})},e.resetSearchIndex=function(){e.searchIndex=1,e.noMoreFIs=!1},e.searchForFIByKeyword=i.debounce(function(){e.resetSearchIndex(),e.searchForFinancialInstitute()},500),e.disableEnterSubmit=function(e){return e&&13===e.which?void e.preventDefault():void 0},e.filterFIsByType=function(t,n){n&&13!==n.which||(e.resetSearchIndex(),i.forEach(e.typeFilters,function(e){e.selected=!1}),e.search.typeFilter=e.typeFilters[t].code,e.typeFilters[t].selected=!0,e.contextLabel=t?e.typeFilters[t].label:"All",e.searchForFinancialInstitute())}},exports.FinancialInstitutionListController.$inject=["$scope","$element","$timeout","lpCoreUtils"],exports.CredentialsViewController=function(e,t){e.pollCount=0,e.authenticateWithSelectedFI=function(){e.fiModel.clearErrors(),e.fiModel.isConnecting=!0;var t;t=e.fiModel.selectedMembership.id?e.fiModel.updateMembershipRequest(e.fiModel.selectedMembership):e.fiModel.createMembershipRequest(e.fiModel.selected),t.then(function(t){e.handleAuthenticationResponse(t)},function(){e.fiModel.isConnecting=!1})},e.updateRequiredCredentials=function(t){e.fiModel.addWarning({captionCode:"extraAuth"}),e.fiModel.selected.requiredUserCredentials=t.credentials,e.fiModel.isConnecting=!1},e.pollForAuth=function(n){t(function(){if(e.pollCount<10){var t=e.fiModel.loadMembershipRequestByID(n);t.then(function(t){e.handleAuthenticationResponse(t),e.pollCount++},function(){e.fiModel.isConnecting=!1,e.pollCount=0})}else e.fiModel.addError({captionCode:"badConnection"}),e.pollCount=0},2e3)},e.handleAuthenticationResponse=function(t){switch(t.status){case"CREATED":e.wizardNextStep(),e.loadAccounts();break;case"CHALLENGE":e.fiModel.selected.extraAuthRequired=!0,e.updateRequiredCredentials(t);break;case"PENDING":e.pollForAuth(t.id)}}},exports.CredentialsViewController.$inject=["$scope","$timeout"]}.call(exports,t,exports,e),!(void 0!==n&&(e.exports=n))},function(e,exports,t){var n;n=function(require,exports,e){"use strict";var n=t(10);exports.lazyLoader=function(e,t){return{restrict:"A",scope:{callBack:"=",stopLoading:"="},link:function(i,r,o){var s,c=function(){return i.widgetElement.height()+i.widgetElement.offset().top},a=t.debounce(function(){s.scrollTop()>c()-150&&(s.off("scroll",a),i.callBack(!0).then(function(){i.stopLoading||s.on("scroll",a)}))},10),l=function(){s=n(e),i.widgetElement=r.closest(".widget"),s.on("scroll",a)};i.$watch("stopLoading",function(t,i){t?n(e).off("scroll",a):i&&!t&&s.on("scroll",a)}),l()}}},exports.lazyLoader.$inject=["$window","lpCoreUtils"]}.call(exports,t,exports,e),!(void 0!==n&&(e.exports=n))},function(e,exports){e.exports=r}])});
//# sourceMappingURL=main.js.map