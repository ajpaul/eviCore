/* widget-portfolio-performance@v2.3.0 build with â™¥ by bb-lp-cli@v1.9.17 */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("base"),require("core"),require("module-charts"),require("module-wealth"),require("d3")):"function"==typeof define&&define.amd?define(["base","core","module-charts","module-wealth","d3"],e):"object"==typeof exports?exports["widget-portfolio-performance"]=e(require("base"),require("core"),require("module-charts"),require("module-wealth"),require("d3")):t["widget-portfolio-performance"]=e(t.base,t.core,t["module-charts"],t["module-wealth"],t.d3)}(this,function(t,e,r,n,o){return function(t){function e(n){if(r[n])return r[n].exports;var o=r[n]={exports:{},id:n,loaded:!1};return t[n].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var r={};return e.m=t,e.c=r,e.p="/",e(0)}([function(t,exports,e){t.exports=e(1)},function(t,exports,e){var r;(function(t){"use strict";r=function(require,exports,t){function r(t,e){e.setConfig({portfolioEndPoint:t.getPreference("dataSrc")})}r.$inject=["lpWidget","lpWealth"],t.name="widget-portfolio-performance";var n=e(3),o=e(4),a=e(5),i=e(6),c=[o.name,a.name,i.name];t.exports=n.createModule(t.name,c).controller(e(7)).directive(e(8)).run(r)}.call(exports,e,exports,t),!(void 0!==r&&(t.exports=r))}).call(exports,e(2)(t))},function(t,exports){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children=[],t.webpackPolyfill=1),t}},function(e,exports){e.exports=t},function(t,exports){t.exports=e},function(t,exports){t.exports=r},function(t,exports){t.exports=n},function(t,exports,e){var r;r=function(require,exports,t){"use strict";exports.MainCtrl=function(t,e,r,n){function o(t){i.loading=!1,i.data=t}function a(){i.title=i.modeAvail&&c.mode?"Performance":"Valuation"}var i=this,c=i.config={frequency:n.getConfig("frequency"),mode:!0};i.modeAvail=i.modeAvail||!1,i.toggleMode=function(){c.mode=!c.mode,a()},i.onSwitch=function(t){e(function(){i.modeAvail=t,a()})},r.subscribe("launchpad-retail.portfolioSelected",function(e){i.loading=!0,t.getData(e.id).then(o)}),r.subscribe("portfolio-frequency",function(t){e(function(){c.frequency=t})})},exports.MainCtrl.$inject=["ptfModel","$timeout","lpCoreBus","lpWealth"]}.call(exports,e,exports,t),!(void 0!==r&&(t.exports=r))},function(t,exports,e){var r;r=function(require,exports,t){"use strict";var r=e(9),n=e(3).ng,o=10,a=50,i={top:10,bottom:20},c={top:-5,left:15},l={monthly:r.time.format.multi([["%b %Y",function(t){return 0===t.getMonth()}],["%b",function(t){return 1===t.getDate()}],["",function(){return!0}]]),yearly:r.time.format.multi([["%Y",function(t){return 0===t.getMonth()}],["",function(){return!0}]])},u="translate("+c.left+","+c.top+")";exports.lpWealthPerformance=function(t,e,c,f,d,s,p,m,h,g,v){function x(t){var e=S(t),r=t[e];return 0===e&&M(r)?-1:q(r)}function y(d,y){function M(t){return t.datapoint.totalPortfolioValue}function S(t){return U?t.datapoint.valueChangeRate:t.datapoint.totalPortfolioValue}function P(t,e){return[Math.min(r.min(t),r.min(e)),Math.max(r.max(t),r.max(e))]}function A(t){return S(t)<0?"negative":""}function z(t){return R?0:U?Math.min(O(0),H(t)):H(t)}function W(t){return R?(V-a)/2:et.xScale(et.parsers.x(t))-T/2}function $(t,e){for(var r,n,o,a,i,c=C(e,t[0],0,e.length-1),l=C(e,t[1]||t[0],0,e.length-1),u=[],f=c;f<=l;f++)i=f-c,r=1+S(e[f])/100,o=0===i?r:r*(1===i?n:a),n=r,a=o,u.push({date:e[f].date,data:100*(o-1)});return u}function j(){if(d.data){var t=d.data[L.frequency],e=d.range;if(R=!0,e&&t.length>1&&(R=!1,N.domain(e),B!==e[0]>I&&(B=e[0]>I,U=B&&_,d.onSwitch({modeIsAvailable:B}))),U)D=$(e,t),O.domain(P(D.map(w),t.map(S)));else{D=[];var n=M(t[0]);O.domain(R?[n*(1-o/100),n]:r.extent(t,S))}rt.data=D,at.render(),it.render(),nt.render(),T=E/c.getDomainSize(N)*.75||a,ot.barWidth(T),ot.render(),K.select(".x.axis").attr("transform","translate("+(R?V/2:0)+","+Y+")"),K.select(".y.axis").selectAll("text").attr("transform",u),K.select(".x.zero").attr("transform","translate(0,"+O(0)+")")}}function k(){V=y.innerWidth(),Y=y.innerHeight()-i.top-i.bottom,V<=0||Y<=0||(X.width(V),N.range([0,V]),O.range([Y,0]),J.attr("width",V).attr("height",Y+i.top+i.bottom),nt.resize(V,Y),ct.resize(V,Y),K.select(".x.zero line").attr("x2",V),F())}function F(){var t=d.data;t&&(t=t[L.frequency],!t||t.length<1||(et.data=t,I=x(t),N.domain(r.extent(t,q)),E=V/t.length*c.getDomainSize(N),et.formatters.x=l[L.frequency],j()))}var D,V,Y,E,I,U,B,R,T,H,L=d.config,N=r.time.scale(),O=r.scale.linear(),X=f.ticks(),_=!0,G=y.find("svg")[0];H=e.compose(O,S);var J=r.select(G),K=J.append("g").attr("transform","translate(0,"+i.top+")"),Q=r.format(".2s"),Z={monthly:r.time.format("%b %Y"),yearly:r.time.format("%Y")},tt=r.format("+,.2f"),et={node:K,centerSingleTick:!0,xScale:N,yScale:O,parsers:{x:q,y:function(t){return Math.max(0,S(t))}},formatters:{y:function(t){return U?t+"%":Q(t)},tooltip:function(t){var e=t.datapoint.currency;return"<div>"+Z[L.frequency](q(t))+"</div><div>"+s.formatCurrency(M(t),e)+"</div>"+(U?"<div>"+tt(S(t))+"%</div>":"")+"<div> &rarr; "+s.formatCurrency(t.datapoint.cashIn,e)+"</div><div> &larr; "+s.formatCurrency(t.datapoint.cashOut,e)+"</div>"+(U?"<div>Cumul: "+w(D[C(D,q(t))]).toFixed(2)+"%</div>":"")}}},rt={node:K,xScale:N,yScale:O,parsers:{x:q,y:w}},nt=p(et).ticks({x:X,y:5}),ot=m(et).attr("class","bars").itemAttr({class:A,y:z,x:W,height:function(t){return R?Y:U?Math.abs(O(0)-H(t)):Y-H(t)}}),at=h(rt),it=g(rt).attr("class","dots");K.append("g").attr("class","x axis zero").append("line");var ct=v(et);k(),c.onParentPanelToggle(y,k);var lt=e.compose(j,function(t){d.range=t});b.subscribe("portfolio-rangeSelected",lt),b.subscribe("portfolio-rangeSelected-live",lt),d.$watch("data",F),d.$watch("config.frequency",F),d.$watch("config.mode",function(t){_=t,U=B&&_,j()}),n.element(t).on("resize",e.debounce(k,250))}var b=d,q=e.property("date"),w=e.property("data"),M=function(t,e){return null===t.datapoint.valueChangeRate?0:1},S=r.bisector(M).right,C=r.bisector(q).left;return{restrict:"EA",require:"?ngModel",priority:Number.MAX_VALUE,link:y,template:"<svg/>",scope:{config:"=lpWealthPerformance",data:"=ngModel",onSwitch:"&"}}},exports.lpWealthPerformance.$inject=["$window","utils","wealthUtils","lpChartUtils","lpCoreBus","lpCoreI18n","axesFactory","barsFactory","lineFactory","pointsFactory","tooltipFactory"]}.call(exports,e,exports,t),!(void 0!==r&&(t.exports=r))},function(t,exports){t.exports=o}])});
//# sourceMappingURL=main.js.map