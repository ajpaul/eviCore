/* widget-accounts@v2.11.3 build with â™¥ by bb-lp-cli@v1.9.5 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("base"),require("core"),require("ui")):"function"==typeof define&&define.amd?define(["base","core","ui"],t):"object"==typeof exports?exports["widget-accounts"]=t(require("base"),require("core"),require("ui")):e["widget-accounts"]=t(e.base,e.core,e.ui)}(this,function(e,t,n){return function(e){function t(o){if(n[o])return n[o].exports;var c=n[o]={exports:{},id:o,loaded:!1};return e[o].call(c.exports,c,c.exports,t),c.loaded=!0,c.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,exports,t){e.exports=t(1)},function(e,exports,t){var n;(function(e){"use strict";n=function(require,exports,e){function n(e,t){t&&t.model&&e.publish("cxp.item.loaded",{id:t.model.name})}n.$inject=["lpCoreBus","lpWidget"],e.name="widget-accounts";var o=t(3),c=t(4),s=t(5),i=[c.name,s.name];e.exports=o.createModule(e.name,i).directive(t(6)).directive(t(7)).directive(t(8)).directive(t(9)).service(t(10)).factory(t(11)).controller(t(12)).run(n)}.call(exports,t,exports,e),!(void 0!==n&&(e.exports=n))}).call(exports,t(2)(e))},function(e,exports){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children=[],e.webpackPolyfill=1),e}},function(t,exports){t.exports=e},function(e,exports){e.exports=t},function(e,exports){e.exports=n},function(e,exports,t){var n;n=function(require,exports,e){"use strict";exports.lpAccountsAssetsGroup=function(e){function t(e,t){var n=['<div accordion-group="accordion-group" is-open="group.isOpen" ng-show="preferences.showGroups && group.accounts.length > 0">','<div accordion-heading="accordion-heading">','<span lp-i18n="{{ group.title }}"></span>',"<i class=\"fa\" ng-class=\"{ 'fa-caret-up': group.isOpen, 'fa-caret-down': !group.isOpen }\"></i>",'<span ng-show="preferences.showTotals" class="group-totals pull-right"','lp-amount="groupTotal.totalBalance"','hide-trailing-zeroes="true"','lp-amount-currency="groupTotal.currency"></span>',"</div>",'<div lp-accounts-assets-list=""',' select-account="selectAccount({account: account, groupCode: group.code})"',' group="group"',' preferences="preferences"',' selected-account-id="selectedAccountId">',"</div>","</div>"].join(""),o=['<div class="panel-heading panel-round clearfix cursor-pointer"','ng-show="preferences.showGroups && group.accounts.length > 0" tabindex="0"','ng-click="group.isCollapsed = !group.isCollapsed">','<span class="pull-left" lp-i18n="{{ group.title }}"></span>','<span class="pull-right caret"></span>','<span ng-show="preferences.showTotals" class="group-totals pull-right"','lp-amount="groupTotal.totalBalance"','hide-trailing-zeroes="true"','lp-amount-currency="groupTotal.currency"></span>',"</div>",'<div lp-accounts-assets-list="" select-account="selectAccount({account: account, groupCode: group.code})"',' group="group"',' preferences="preferences"',' selected-account-id="selectedAccountId"',' ng-hide="group.isCollapsed">',"</div>"].join("");return t&&"true"===t.accordionEnabled?n:o}function n(t){t.groupTotal=e.getGroupTotal(t.group,t.preferences.defaultBalance)}return{restrict:"AE",scope:{group:"=",preferences:"=",selectedAccountId:"=",selectAccount:"&"},template:t,link:n}},exports.lpAccountsAssetsGroup.$inject=["lpAccountsUtils"]}.call(exports,t,exports,e),!(void 0!==n&&(e.exports=n))},function(e,exports,t){var n;n=function(require,exports,e){"use strict";exports.lpAccountsAssetsList=function(){function e(){return['<ul class="list-group">','<li class="list-group-item panel-body cursor-pointer"','tabindex="0" role="button"','ng-repeat="account in group.accounts"','on-select="selectAccount({account: account, groupCode: group.code})"','ng-class="{ selected: selectedAccountId == account.id }">','<span class="lp-line-item-arrow">','<i class="lp-icon lp-icon-angle-right"></i>',"</span>",'<div lp-accounts-assets-account="" ',' account="account"',' group="group"',' selected-account-id="selectedAccountId"',' preferences="preferences">',"</div>","</li>","</ul>"].join("")}return{restrict:"AE",scope:{group:"=",selectedAccountId:"=",preferences:"=",selectAccount:"&"},template:e}}}.call(exports,t,exports,e),!(void 0!==n&&(e.exports=n))},function(e,exports,t){var n;n=function(require,exports,e){"use strict";exports.lpAccountsAssetsAccount=function(){function e(){return['<div class="grouped-account clearfix" ng-class="{ \'bg-danger\': account.alerts }">',"<span ng-if=\"group.code === 'card'\"",'class="account-icon lp-icon lp-icon-credit-card pull-left"','ng-style="{ color: account.iconColor }"></span>','<p ng-if="group.code !== \'card\'" ng-show="preferences.showAccountHolderName">{{ account.holder }}</p>','<p class="pull-left">',"<span>",'{{ account.alias }} <span ng-if="account.shortReferenceId">({{ account.shortReferenceId }})</span>',"</span>","</p>",'<span ng-if="preferences.defaultBalance !== \'current\'" class="account-balance pull-right"','lp-amount="account.availableBalance" lp-amount-currency="account.currency"','hide-trailing-zeroes="true" ng-model="account"></span>','<span ng-if="preferences.defaultBalance === \'current\'" class="account-balance pull-right"','lp-amount="account.bookedBalance" lp-amount-currency="account.currency"','hide-trailing-zeroes="true" ng-model="account"></span>','<p ng-if="group.code !== \'card\'" ng-show="preferences.showAccountType">{{ account.product }}</p>','<p ng-if="group.code !== \'card\'" ng-show="preferences.showAccountHolderCategory">',"{{ account.relationship }}","</p>","</div>"].join("")}function t(e,t,n){}return{restrict:"AE",scope:{account:"=",group:"=",selectedAccountId:"=",preferences:"="},template:e,link:t}}}.call(exports,t,exports,e),!(void 0!==n&&(e.exports=n))},function(e,exports,t){var n;n=function(require,exports,e){"use strict";exports.onSelect=function(e){return{restrict:"A",compile:function(t,n){var o=e(n.onSelect);return function(e,t){t.on("click keydown",function(t){"click"!==t.type&&13!==t.which&&32!==t.which||(t.preventDefault(),t.stopPropagation(),e.$apply(function(){o(e,{$event:t})}))})}}}},exports.onSelect.$inject=["$parse"]}.call(exports,t,exports,e),!(void 0!==n&&(e.exports=n))},function(e,exports,t){var n;n=function(require,exports,e){"use strict";var n=t(3).utils,o=function(e){return e.accountServicer&&e.accountServicer.id},c=function(e){return!o(e)||e.accountServicer.display},s=function(e){var t=n.clone(e);return t.availableBalance=parseFloat(e.availableBalance),t.bookedBalance=parseFloat(e.bookedBalance),t},i=function(e){var t=n.cloneDeep(e);return n.forEach(t,function(e,t){e.accounts=n(e.accounts).chain().filter(c).map(s).value(),e.isOpen=!t}),t},r=function(e){var t={internal:{},external:{}};return n.forOwn(e,function(e,c){t.internal[c]=[],t.external[c]=[],n.forEach(e,function(e){o(e)?t.external[c].push(e):t.internal[c].push(e)})}),t},a=function(e,t){return n.chain(e).map(function(e,o){var c=n.find(t,function(t,n){return e.code===n});return{title:e.defaultTitle,code:e.code,accounts:c||[],isCollapsed:!1,isOpen:!1}}).remove(function(e){return e.accounts.length}).value()},l=function(e){return n(e).reduce(function(e,t){return t.accounts.forEach(function(e,n){e.code=t.code,0===n&&(e.groupTitle=t.title,e.groupAccountsCount=t.accounts.length)}),e.concat(t.accounts)},[])},u=function(e,t){this.bus=e,this.resource=t,this.accounts=null,this.groups=null,this.assetCollection=[],this.error=!1,this.bus.subscribe("launchpad-retail:ACCOUNT_BALANCE_CHANGED",function(e){null!==this.accounts&&this.load()}.bind(this))};u.$inject=["lpCoreBus","$resource"],u.prototype.config=function(e){e.assetsEndpoint=n.resolvePortalPlaceholders(e.assetsEndpoint),this.assetsResource=this.resource(e.assetsEndpoint),this.groupsEnabled=!!e.groupsEndpoint,this.groupByInternalExternal=!!e.groupByInternalExternal,this.groupsEnabled&&(e.groupsEndpoint=n.resolvePortalPlaceholders(e.groupsEndpoint),this.groupsResource=this.resource(e.groupsEndpoint)),this.filterByGroupCode=e.groupCodeFilter},u.prototype.first=function(){var e=this.groupsEnabled?this.assetCollectionFlat:this.assetCollection;return e.length>0&&e[0]},u.prototype.load=function(){return this.assetsResource.get().$promise.then(function(e){if(this.accounts=e,this.bus.publish("launchpad-retail.accountsLoaded",e["current-account"]),this.groupsEnabled)return this.groupsResource.query().$promise.then(function(e){if(this.groups=e,this.groupByInternalExternal){var t=r(this.accounts);this.internalCollection=i(a(this.groups,t.internal)),this.externalCollection=i(a(this.groups,t.external)),this.assetCollection=this.internalCollection.concat(this.externalCollection),this.assetCollectionFlat=l(this.assetCollection)}else this.assetCollection=i(a(this.groups,this.accounts)),this.assetCollectionFlat=l(this.assetCollection);return this.accounts}.bind(this));if(this.groupByInternalExternal){var t=r(this.accounts);this.internalCollection=i(t.internal),this.externalCollection=i(t.external),this.assetCollection=this.internalCollection.concat(this.externalCollection)}else this.assetCollection=i(this.accounts);return n.forEach(this.accounts,this.configurePreviousBalanceDelta),this.accounts}.bind(this))},u.prototype.findAccountById=function(e){return n(this.assetCollectionFlat).findWhere({id:e})},u.prototype.getPending=function(e){return e.bookedBalance-e.availableBalance},u.prototype.configurePreviousBalanceDelta=function(e){this.previousBalances?(this.previousBalances[e.id]>e.availableBalance?e.delta=-1:this.previousBalances[e.id]<e.availableBalance?e.delta=1:e.delta=0,this.previousBalances[e.id]=e.availableBalance):(this.previousBalances=[],e.delta=0,this.previousBalances[e.id]=e.availableBalance)},u.prototype.hasExternalAccounts=function(){return!(!this.externalCollection||!n(this.externalCollection).chain().values().pluck("accounts").flatten().value().length)},exports.AssetsModel=u}.call(exports,t,exports,e),!(void 0!==n&&(e.exports=n))},function(e,exports,t){var n;n=function(require,exports,e){"use strict";var n=t(3).utils;exports.lpAccountsUtils=function(){return{getGroupTotal:function(e,t){var o,c=0;return n.forEach(e.accounts,function(e){c+=e[t+"Balance"],o=e.currency}),{totalBalance:c,currency:o}}}}}.call(exports,t,exports,e),!(void 0!==n&&(e.exports=n))},function(e,exports,t){var n;n=function(require,exports,e){"use strict";function n(e,t,n,s,i,r,a){this.layout=n.getPreference("widgetLayout"),this.getGroupTotal=function(e){return a.getGroupTotal(e,this.preferences.defaultBalanceMapped)},this.scope=e,this.bus=r,this.widget=n,this.model=s,this.widget.addEventListener("preferencesSaved",this.refreshWidget.bind(this)),this.bus.subscribe("lpDataFreshnessRefresh",function(){o.safeApply(this.scope,this.load.bind(this))}.bind(this)),this.bus.subscribe("launchpad-retail.accountSelected",function(t){o.safeApply(e,function(){this.model.selected=t.accountId}.bind(this))}.bind(this)),this.bus.subscribe("widget-account-details:default-account:set",this.setDefaultAccountId.bind(this)),i.enable(t).rule({"max-width":200,then:c(e,"lp-tile-size")}).rule({"min-width":201,"max-width":350,then:c(e,"lp-small-size")}).rule({"min-width":351,"max-width":600,then:c(e,"lp-normal-size")}).rule({"min-width":601,then:c(e,"lp-large-size")}),this.config(),this.load()}n.$inject=["$scope","$rootElement","lpWidget","AssetsModel","lpUIResponsive","lpCoreBus","lpAccountsUtils"];var o=t(3).utils,c=function(e,t){return function(){o.safeApply(e,function(){e.responsiveClass=t})}},s={current:"booked",available:"available"};n.prototype.setDefaultAccountId=function(e){var t=e&&e.id||"";this.widget.setPreference("defaultAccountId",t),this.widget.model.save(),this.preferences&&(this.preferences.defaultAccountId=t),this.bus.publish("widget-accounts:default-account:select",e)},n.prototype.selectDefaultAccount=function(){if(!this.preferences.selectDefaultAccount)return!0;if(this.preferences.defaultAccountId){var e=this.model.findAccountById(this.preferences.defaultAccountId);this.selectAccount(e,e.code),this.openDefaultAccountGroup(e),this.bus.publish("widget-accounts:default-account:select",e)}return!!this.preferences.defaultAccountId},n.prototype.openDefaultAccountGroup=function(e){var t=this.model.groupByInternalExternal?this.model.internalCollection:this.assetCollection;o.forEach(t,function(t){t.isOpen=e.code===t.code})},n.prototype.config=function(){this.title=this.widget.getPreference("title"),this.preferences={showGroups:o.parseBoolean(this.widget.getPreference("showGroups")),showTotals:o.parseBoolean(this.widget.getPreference("showGroupTotals")),showAccountHolderName:o.parseBoolean(this.widget.getPreference("showAccountHolderName")),showAccountType:o.parseBoolean(this.widget.getPreference("showAccountType")),showAccountHolderCategory:o.parseBoolean(this.widget.getPreference("showAccountHolderCategory")),selectDefaultAccount:o.parseBoolean(this.widget.getPreference("selectDefaultAccount")),groupByInternalExternal:o.parseBoolean(this.widget.getPreference("groupByInternalExternal")),showAllFinances:o.parseBoolean(this.widget.getPreference("showAllFinances")),defaultBalance:this.widget.getPreference("preferredBalanceView")||this.widget.getPreferenceFromParents("preferredBalanceView")||"current",defaultAccountId:this.widget.getPreference("defaultAccountId"),internalIsOpen:!0,externalIsOpen:!1},this.preferences.defaultBalanceMapped=s[this.preferences.defaultBalance]||this.preferences.defaultBalance,this.model.config({assetsEndpoint:this.widget.getResolvedPreference("accountsDataSrc"),groupsEndpoint:this.widget.getResolvedPreference("groupsDataSrc"),groupByInternalExternal:this.preferences.groupByInternalExternal})},n.prototype.load=function(){var e;this.model.loadingNow=!0,this.model.noAccountsAvailable=!1,this.model.load().then(function(){this.model.loadingNow=!1,this.model.accounts&&(this.model.accounts["current-account"]&&this.model.accounts["current-account"].length||this.model.accounts.card&&this.model.accounts.card.length||this.model.accounts["current-portfolio"]&&this.model.accounts["current-portfolio"].length)||(this.model.noAccountsAvailable=!0),this.selectDefaultAccount()||(e=this.model.first(),o.isPlainObject(e)&&this.selectAccount(e,e.code)),this.bus.subscribe("account-details:account:update",function(e){o.safeApply(this.scope,this.updateAccountDetails.bind(this,e))}.bind(this))}.bind(this))["finally"](function(){this.model.loadingNow=!1}.bind(this))["catch"](function(e){throw this.model.error="Failed to load accounts."}.bind(this))},n.prototype.refreshWidget=function(){this.widget.refreshHTML(),this.load()},n.prototype.updateAccountDetails=function(e){var t=this.model.findAccountById(e.id);t&&o.assign(t,e)},n.prototype.selectAccount=function(e,t){this.model.selected=e.id,"portfolio"===e.type?this.bus.publish("launchpad-retail.portfolioSelected",e):t&&"card"===t?(this.bus.publish("launchpad-retail.openCardManagement"),this.bus.publish("launchpad-retail.cardSelected",{account:e})):this.bus.publish("launchpad-retail.accountSelected",{accountId:e.id,originType:"accounts"},!0)},n.prototype.payForAccount=function(e,t){e.stopPropagation(),this.bus.publish("launchpad-retail.requestMoneyTransfer",{accountId:t})},n.prototype.openAllFinances=function(){this.bus.publish("launchpad-retail.accountSelected",{accountId:"000-000-000",originType:"accounts"})},exports.MainCtrl=n}.call(exports,t,exports,e),!(void 0!==n&&(e.exports=n))}])});
//# sourceMappingURL=main.js.map