/* Build with bb-lp-cli @ v1.7.1 */
!function(t,i){"object"==typeof exports&&"object"==typeof module?module.exports=i(require("base"),require("core"),require("ui")):"function"==typeof define&&define.amd?define(["base","core","ui"],i):"object"==typeof exports?exports["widget-notifications"]=i(require("base"),require("core"),require("ui")):t["widget-notifications"]=i(t.base,t.core,t.ui)}(this,function(t,i,o){return function(t){function i(n){if(o[n])return o[n].exports;var e=o[n]={exports:{},id:n,loaded:!1};return t[n].call(e.exports,e,e.exports,i),e.loaded=!0,e.exports}var o={};return i.m=t,i.c=o,i.p="",i(0)}([function(t,exports,i){var o;(function(t){o=function(require,exports,t){"use strict";function o(t,i){i.model&&i.model.name&&t.publish("cxp.item.loaded",{id:i.model.name}),n.notification.network()}t.name="widget-notifications";var n=i(2),e=i(3),r=i(4),c=[e.name,r.name];o.$inject=["lpCoreBus","lpWidget"],t.exports=n.createModule(t.name,c).constant(i(5)).controller(i(6)).factory(i(7)).directive(i(8)).run(o)}.call(exports,i,exports,t),!(void 0!==o&&(t.exports=o))}).call(exports,i(1)(t))},function(t,exports){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children=[],t.webpackPolyfill=1),t}},function(i,exports){i.exports=t},function(t,exports){t.exports=i},function(t,exports){t.exports=o},function(t,exports,i){var o;o=function(require,exports,t){"use strict";exports.widgetPrefs={NOTIFICATIONS_ENDPOINT:"notificationsEndpoint",IGNORE_ENROLLMENT_ENDPOINT:"ignoreEnrollmentEndpoint",CLOSE_NOTIFICATION_ENDPOINT:"closeNotificationEndpoint",POLL_INTERVAL:"pollInterval",ALLOW_PUBSUB:"allowPubsub"}}.call(exports,i,exports,t),!(void 0!==o&&(t.exports=o))},function(t,exports,i){var o;o=function(require,exports,t){"use strict";var o=function(t){t.$$phase||t.$apply()},n=i(2).queue;exports.NotificationsController=function(t,i,e,r,c,a,s,l,f,u){function d(i){if(i.notification){var n=i.notification,e=n.container&&n.container.type||"panel";N.template="templates/type-"+e+".html",("object"==typeof n.data||n.data)&&window.angular.extend(n,n.data),n.className=N.getAlertClass(n),n.message=u.escape(n.message),C.addNotification(i.notification),N.closeAllButton=!C.notifications.some(function(t){return!t.closable}),o(t)}}var p=f,N=this;this.template="templates/type-panel.html",this.closeAllButton=!1,this.locale="en-US",this.offsetTopCorrection={},this.offsetMarginCorrection={},this.fixedBar=u.parseBoolean(e.getPreference("fixedBar"));var g=e.getPreference(a.NOTIFICATIONS_ENDPOINT),h=e.getPreference(a.IGNORE_ENROLLMENT_ENDPOINT),m=e.getPreference(a.CLOSE_NOTIFICATION_ENDPOINT),v=u.parseBoolean(e.getPreference(a.ALLOW_PUBSUB)),b=parseInt(e.getPreference(a.POLL_INTERVAL),10);c.configureNotifications({ignore:[g,h]});var C=s.getInstance({notificationsEndpoint:g,closeNotificationEndpoint:m,onNotificationAdded:function(t){e.model.fireEvent("notification-added",!0,!0,{notification:t})}});this.model=C,r.userId&&"null"!==r.userId&&(C.loadNotifications(),!isNaN(b)&&b>999&&g&&C.startPolling(b)),v&&(n.onPush(function(i,e){var r="launchpad-widget-notification-retry_",c=r+i.contextId,a=C.getNotificationById(c);a?(a.data.message=a.data.message.concat(i.messages),o(t)):d({notification:{id:c,level:i.notification&&i.notification.level||"severe",data:{message:[].concat(i.messages)},container:{type:"overlay",template:"templates/retry.html"},retry:{action:function(){n.retry(e).then(function(){N.closeNotification({id:c})})},cancel:function(){n.cancel(e).then(function(){N.closeNotification({id:c})})}}}})}),p.subscribe("launchpad.add-notification",d),p.subscribe("launchpad.remove-notification",function(i){i.notification&&i.notification.id&&(C.removeNotification(i.notification.id),o(t))}),p.subscribe("launchpad-retail.offsetTopCorrection",function(i){i.offsetTopCorrection>=0&&(N.offsetTopCorrection={top:i.offsetTopCorrection},N.offsetMarginCorrection=N.fixedBar?{}:{top:i.offsetTopCorrection},o(t))})),this.getAlertClass=C.getAlertClass,this.isDesignMode=function(){return r.designMode},this.closeNotification=function(i){C.closeNotification(i).then(function(){C.notifications.length>0&&t.$broadcast("lp.notifications.focus")})},this.closeAllNotifications=function(){C.notifications.forEach(function(t){C.closeNotification(t)})}},exports.NotificationsController.$inject=["$scope","$rootElement","lpWidget","lpPortal","lpCoreHttpInterceptor","widgetPrefs","NotificationsModel","i18nUtils","lpCoreBus","lpCoreUtils"]}.call(exports,i,exports,t),!(void 0!==o&&(t.exports=o))},function(t,exports,i){var o;o=function(require,exports,t){"use strict";exports.NotificationsModel=function(t,i,o,n){var e=function(t){t=t||{},this.notifications=[],this.notificationsEndpoint=t.notificationsEndpoint,this.closeNotificationEndpoint=t.closeNotificationEndpoint,this.updateReceivedEndpoint=t.updateReceivedEndpoint,this.polling=!1,this.onNotificationAdded=t.onNotificationAdded,this.loading=!1};return e.prototype.startPolling=function(t){var o=this;if(!this.polling){this.polling=!0;var n=function(){var e=o.loadNotifications();e.success(function(){o.pollingTimeout=i(function(){n()},t)})};this.pollingTimeout=i(function(){n()},t)}},e.prototype.stopPolling=function(){this.pollingTimeout&&(i.cancel(this.pollingTimeout),this.polling=!1)},e.prototype.loadNotifications=function(){var t=this,i=o.getInstance({endpoint:this.notificationsEndpoint,cacheTimeout:0});this.loading=!0;var e=i.read();return e.success(function(i){var o=i.messages||i.notifications;o&&n.forEach(o,function(i){i.className=t.getAlertClass(i),t.addNotification(i)})}),e.error(function(i){i.errors&&(t.errorCode=i.errors[0])}),e["finally"](function(){t.loading=!1}),e},e.prototype.getAlertClass=function(t){var i={INFO:"alert-info",WARNING:"alert-warning",ALERT:"alert-danger"};return i[t.level]||"alert-info"},e.prototype.addNotification=function(t){if("string"==typeof t.id||"number"==typeof t.id){for(var i=!1,o=0;o<this.notifications.length&&!i;o++)t.id&&this.notifications[o].id===t.id&&(this.notifications[o]=t,i=!0);i||(this.notifications.push(t),"function"==typeof this.onNotificationAdded&&this.onNotificationAdded.call(null,t))}},e.prototype.removeNotification=function(t){var i=this.notifications.filter(function(i){return i.id===t});i.length&&this.notifications.splice(this.notifications.indexOf(i[0]),1)},e.prototype.closeNotification=function(t){var n=this,e=function(){n.removeNotification(t.id);var i=o.getInstance({endpoint:n.closeNotificationEndpoint,urlVars:{id:t.id}});i.create({contentType:"application/json"})},r=function(){return i(function(){n.loading?r():e()},100)};return r()},e.prototype.getNotificationById=function(t){return this.notifications.filter(function(i){return i.id===t})[0]||null},{getInstance:function(t){return new e(t)}}},exports.NotificationsModel.$inject=["$rootScope","$timeout","httpService","lpCoreUtils"]}.call(exports,i,exports,t),!(void 0!==o&&(t.exports=o))},function(t,exports,i){var o;o=function(require,exports,t){"use strict";exports.lpAllowPubsubClick=function(t,i){return{restrict:"A",scope:{numberAllowed:"@lpAllowPubsubClick",invokerClassName:"@"},link:function(o,n,e){var r=t;o.numberAllowed=parseInt(o.numberAllowed,10)||0,o.invokerClassName=o.invokerClassName||"pubsub-invoker",o.numberAllowed>0&&o.invokerClassName&&(o.invokers=n[0].querySelectorAll("."+o.invokerClassName),i.forEach(o.invokers,function(t,i){i<o.numberAllowed&&t.addEventListener("click",function(t){var i,o;i=t.target.getAttribute("data-pubsub-name"),o=t.target.getAttribute("data-pubsub-arguments"),i&&r.publish(i,o)})}))}}},exports.lpAllowPubsubClick.$inject=["lpCoreBus","lpCoreUtils"]}.call(exports,i,exports,t),!(void 0!==o&&(t.exports=o))}])});
//# sourceMappingURL=main.js.map