/* widget-ebill-add@v3.1.0 build with â™¥ by bb-lp-cli@v1.9.12 */
!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n(require("base"),require("core"),require("ui"),require("module-payments"),require("module-accounts"),require("module-ebilling")):"function"==typeof define&&define.amd?define(["base","core","ui","module-payments","module-accounts","module-ebilling"],n):"object"==typeof exports?exports["widget-ebill-add"]=n(require("base"),require("core"),require("ui"),require("module-payments"),require("module-accounts"),require("module-ebilling")):e["widget-ebill-add"]=n(e.base,e.core,e.ui,e["module-payments"],e["module-accounts"],e["module-ebilling"])}(this,function(e,n,t,r,i,o){return function(e){function n(r){if(t[r])return t[r].exports;var i=t[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}var t={};return n.m=e,n.c=t,n.p="/_karma_webpack_//",n(0)}([function(e,exports,n){e.exports=n(1)},function(e,exports,n){var t;(function(e){"use strict";t=function(require,exports,e){function t(e,n,t){t.setConfig({url:n.getPreference("billPaymentsDataSrc")}),n.model&&n.model.name&&e.publish("cxp.item.loaded",{id:n.model.name})}t.$inject=["lpCoreBus","lpWidget","lpEBillService"],e.name="widget-ebill-add";var r=n(3),i=n(4),o=n(5),l=n(6),a=n(7),c=n(8),s=[i.name,o.name,l.name,a.name,c.name];e.exports=r.createModule(e.name,s).controller(n(9)).service(n(10)).directive(n(11)).run(t)}.call(exports,n,exports,e),!(void 0!==t&&(e.exports=t))}).call(exports,n(2)(e))},function(e,exports){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children=[],e.webpackPolyfill=1),e}},function(n,exports){n.exports=e},function(e,exports){e.exports=n},function(e,exports){e.exports=t},function(e,exports){e.exports=r},function(e,exports){e.exports=i},function(e,exports){e.exports=o},function(e,exports,n){var t;t=function(require,exports){"use strict";var e=n(3).utils,t={};exports.MainCtrl=function(e,n){this.wizard=t,this.bpService=e,this.bpModel=n},exports.MainCtrl.$inject=["bpService","bpModel"],exports.FindPayeeCtrl=function(n,r,i,o,l){function a(){c.searchValue?o.searchVendors({name:c.searchValue}).then(function(e){c.listGroup=e}):c.loadVendors()}var c=this;c.searchValue="",c.pay=function(){t.goToStep(4)},c.loadVendors=function(){o.getTopVendors().then(function(e){c.topVendors=e,c.listGroup=e})},c.selectBiller=function(n){l.currentBiller=e.clone(n),l.currentBiller.paymentMethod=l.paymentMethods.ELECTRONIC,l.currentBiller.address={},l.currentBiller.addresses=[],t.nextStep()},c.createBiller=function(e){l.currentBiller={paymentMethod:l.paymentMethods.CHECK,name:e,address:{}},t.nextStep()};var s=i.debounce(a,500);c.search=function(){c.searching=Boolean(c.searchValue),s()},c.clearSearch=function(){o.cancelSearch(),c.searchValue="",c.listGroup=c.topVendors,c.searching=!1},c.loadVendors()},exports.FindPayeeCtrl.$inject=["$scope","lpWidget","lpCoreUtils","bpService","bpModel"],exports.ConnectPayeeCtrl=function(e,n,r,i){var o=this;o.back=function(e){e.ConnectForm.$setPristine(),e.ConnectForm.submitted=!1,r.currentBiller=null,n.errors=null,t.goToStep(1)},o.connect=function(){n.addPayee(r.currentBiller).then(function(e){null===n.errors&&(r.currentBiller=e,r.currentBiller.connected=!0,i.publish("lp-retail:eBill:Payees:load"),"ELIGIBLE"===r.currentBiller.eBillsStatus?n.setupEBills(r.currentBiller).then(function(){r.currentBiller.setupEBills=!0,t.nextStep()}):t.nextStep()),e&&(r.currentBiller.addresses=e.addresses)})},o.setAccountConfirmationStatus=function(e){o.isAccountConfirmed=e}},exports.ConnectPayeeCtrl.$inject=["lpCoreUtils","bpService","bpModel","lpCoreBus"],exports.SetupEBillsCtrl=function(e,n){var t=this;t.errors=[],t.logErrors=function(e){t.errors=e},t.exitEBillSetup=function(){t.errors=[],n.currentBiller.setupEBills=!1}},exports.SetupEBillsCtrl.$inject=["bpService","bpModel"],exports.PayeeAddedCtrl=function(n,r,i){this.eBillsEnabled=function(){return"ACTIVE"===e.get(r,"currentBiller.eBillsStatus")},this.addNewPayee=function(){r.currentBiller=null,r.payment=null,n.errors=null,t.goToStep(1)},this.openDashboard=function(){i.publish("launchpad-retail.openEBillDashboard")},this.createPayment=function(){r.payment=r.paymentModel.createPaymentTemplate(),t.goToStep(4)}},exports.PayeeAddedCtrl.$inject=["bpService","bpModel","lpCoreBus"],exports.PayCtrl=function(n,r,i,o,l,a,c){var s=this,u=function(e){return l("date")(e,"yyyy-MM-dd")},d=function(e){return e.value=i.instant(e.id),e};s.frequencies=e.map(r.paymentModel.frequencies,d),s.endOptions=e.map(r.paymentModel.endOptions,d),s.isConnecting=!0,a.payment=r.payment;var p=function(e){if(e){var n=a.payment.urgentTransfer?1:r.currentBiller.businessDaysToDeliver,t=u(e);o.getBusinessDay(t,n).then(function(e){a.payment.estDeliveryDate=e})}};a.$watch("payment.urgentTransfer",function(){p(a.payment.scheduleDate)}),a.$watch("payment.scheduleDate",function(e){p(e)}),this.showUrgentTransfer=function(){return r.currentBiller.canExpeditePayments&&r.currentBiller.paymentMethod===r.paymentMethods.CHECK};var f=function(e){return s.warnings=[],e.account||s.warnings.push({code:"ERROR_SELECT_ACCOUNT"}),e.scheduleDate||s.warnings.push({code:"ERROR_ENTER_PROCESSING_DATE"}),e.amount||s.warnings.push({code:"ERROR_ENTER_AMOUNT"}),e.isScheduledTransfer&&(e.scheduledTransfer.frequency||s.warnings.push({code:"ERROR_SELECT_FREQUENCY"}),"after"!==e.scheduledTransfer.endOn||e.scheduledTransfer.timesToRepeat||s.warnings.push({code:"ERROR_ENTER_TIMES_TO_REPEAT"})),!(s.warnings.length>0)};this.pay=function(e){if(f(e)){var t=r.paymentModel.transformPayment(r.currentBiller,e);n.makeAPayment(t).then(function(){null===n.errors&&(e.sent=!0)})}},this.cancel=function(){t.goToStep(1)};var h=n.getAccounts(),m=n.fetchPayee(r.currentBiller);c.all([h,m]).then(function(e){s.accounts=e[0],s.eBills=e[1].eBill,a.payment.account=s.accounts[0]},function(e){})["finally"](function(){s.isConnecting=!1})},exports.PayCtrl.$inject=["bpService","bpModel","lpCoreI18n","calendarService","$filter","$scope","$q"],exports.ConfigureCtrl=function(e){var n=this;n.fiModel=e.fiModel,n.goBack=t.previousStep},exports.ConfigureCtrl.$inject=["fiService"]}.call(exports,n,exports,e),!(void 0!==t&&(e.exports=t))},function(e,exports,n){var t;t=function(require,exports,e){"use strict";var t=n(3).utils,r="";exports.bpModel=function(e){this.paymentMethods={CHECK:"CHECK",ELECTRONIC:"ELECTRONIC"},this.paymentModel=e.getModel(),this.currentBiller={payeeId:null,ebillEligible:null,paymentMethod:null,ebills:null},this.payment=null,this.isCurrentBillerCheck=function(){return this.currentBiller.paymentMethod===this.paymentMethods.CHECK}},exports.bpModel.$inject=["lpEBillPayService"],exports.bpService=function(e,n,i,o,l){var a=this,c=o.resolvePortalPlaceholders(i.getPreference("billPaymentsDataSrc")),s=o.resolvePortalPlaceholders(i.getPreference("instantPaymentOrdersDataSrc"));a.getTopVendors=function(){return a.isConnecting=!0,a.errors=null,e.get(c+"/top-billers"+r).then(function(e){return a.billers=e&&e.data&&e.data.billerGroups||[],a.billers},function(e){a.errors=e.data.errors})["finally"](function(){a.isConnecting=!1})},a.searchVendors=function(n){return a.isConnecting=!0,a.errors=null,e.get(c+"/billers"+r,{params:n}).then(function(e){return a.billers=e&&e.data&&e.data.billers||[],a.billers},function(e){a.errors=e.data.errors})["finally"](function(){a.isConnecting=!1})},a.cancelSearch=function(){a.isConnecting=!1},a.addPayee=function(n){a.isConnecting=!0,a.errors=null;var t={id:n.id,name:n.name,account:n.account,address:n.address,paymentMethod:n.paymentMethod};return e.post(c+"/payees"+r,t).then(function(e){return a.isConnecting=!1,e.data.errors&&e.data.errors.length>0?(a.errors=e.data.errors,n):(n=e.data,n.ebillEligible="ELIGIBLE"===e.data.eBillsStatus,n)},function(e){return a.isConnecting=!1,a.errors=e.data&&e.data.errors,e.data.addresses?(n.addresses=e.data.addresses,n):void 0})},a.getAccounts=function(){return a.isConnecting=!0,a.errors=null,e.get(c+"/accounts"+r).then(function(e){a.isConnecting=!1;var n=[];return t.forEach(e.data.accounts,function(e,t){var r={id:e.accountCode,alias:e.nickName||e.description,bookedBalance:e.totalAmountDue,availableBalance:e.balance,isPrimaryAccount:e.primaryBillPaymentAccount};n.push(r)}),n},function(e){a.isConnecting=!1,a.errors=e.data&&e.data.errors})},a.makeAPayment=function(n){return a.isConnecting=!0,a.errors=null,e.post(s+r,n).then(function(e){return a.isConnecting=!1,n},function(e){a.isConnecting=!1,a.errors=[{code:"500"}]})},a.fetchPayee=function(n){return e.get(c+"/payees/"+n.payeeId+r).then(function(e){return e.data})},a.setupEBills=function(e){return a.isConnecting=!0,l.setup(e).then(function(n){a.isConnecting=!1,e.ebills=n},function(e){a.isConnecting=!1,a.errors=e.data&&e.data.errors})}},exports.bpService.$inject=["$http","$filter","lpWidget","lpCoreUtils","lpEBillService"],exports.calendarService=function(e,n,t){var i=this,o=t.resolvePortalPlaceholders(n.getPreference("calendarDataSrc"));i.getBusinessDay=function(n,t){return i.isConnecting=!0,i.errors=null,e.get(o+"/business-days-after"+r,{params:{date:n,offset:t}}).then(function(e){return i.isConnecting=!1,e.data.errors.length>0&&(i.errors=e.data.errors),e.data.businessDay},function(e){i.isConnecting=!1,i.errors=e.data&&e.data.errors})}},exports.calendarService.$inject=["$http","lpWidget","lpCoreUtils"]}.call(exports,n,exports,e),!(void 0!==t&&(e.exports=t))},function(e,exports,n){var t;t=function(require,exports,e){"use strict";exports.lpSelect=function(){function e(e,n){var t=function(n){"keyup"===n.type&&13!==n.keyCode||e.$apply(function(){e.lpSelect.call(null,{$event:n})})};n.on("click",t),n.on("keyup",t),e.$on("$destroy",function(){n.off(t)})}return{restrict:"A",scope:{lpSelect:"&"},compile:function(n,t){return t.$set("tabindex",0),e},link:e}}}.call(exports,n,exports,e),!(void 0!==t&&(e.exports=t))}])});
//# sourceMappingURL=main.js.map