/* Build with bb-lp-cli @ v1.7.1 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("base"),require("ui"),require("core"),require("module-users"),require("hammerjs")):"function"==typeof define&&define.amd?define(["base","ui","core","module-users","hammerjs"],t):"object"==typeof exports?exports["widget-secure-messaging"]=t(require("base"),require("ui"),require("core"),require("module-users"),require("hammerjs")):e["widget-secure-messaging"]=t(e.base,e.ui,e.core,e["module-users"],e.hammerjs)}(this,function(e,t,r,n,s){return function(e){function t(n){if(r[n])return r[n].exports;var s=r[n]={exports:{},id:n,loaded:!1};return e[n].call(s.exports,s,s.exports,t),s.loaded=!0,s.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,exports,t){var r;(function(e){r=function(require,exports,e){"use strict";function r(e,t){e&&e.model&&t.publish("cxp.item.loaded",{id:e.model.name})}e.name="secure-messaging";var n=t(2),s=t(3),a=t(4),i=t(5),o=[a.name,s.name,i.name];r.$inject=["lpWidget","lpCoreBus"],e.exports=n.createModule(e.name,o).factory(t(6)).service(t(7)).service(t(8)).controller(t(10)).directive(t(11)).run(r)}.call(exports,t,exports,e),!(void 0!==r&&(e.exports=r))}).call(exports,t(1)(e))},function(e,exports){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children=[],e.webpackPolyfill=1),e}},function(t,exports){t.exports=e},function(e,exports){e.exports=t},function(e,exports){e.exports=r},function(e,exports){e.exports=n},function(e,exports,t){var r;r=function(require,exports){"use strict";exports.SharedData=function(e){var t=e,r=function(e){var t=/CN=([^,]+)/i;if(t.test(e)){var r=t.exec(e);return r[1]}return e},n=function(e,r){var n=-1;return t.forEach(e,function(t){return t.id===r?n=e.indexOf(t):void 0}),n},s=function(e,t){var r=n(e,t.id);-1!==r?e[r]=t:e.unshift(t)},a=function(e,t){var r=n(e,t.id);-1!==r&&e.splice(r,1)},i=function(){return 0===this.threads.unread.length&&0===this.threads.read.length&&0===this.draftLetters.length&&0===this.threads.archived.length};return{threads:{unread:[],read:[],archived:[],active:[]},draftLetters:[],addToList:s,removeFromList:a,selectedThread:null,editLetter:null,alerts:[],loading:!1,editLetterInd:!1,resolveDisplayName:r,isInboxEmpty:i}},exports.SharedData.$inject=["lpCoreUtils"],exports.Thread=function(e,t){var r=t.getResolvedPreference("threadSrc");return e(r,{},{queryActive:{method:"GET",params:{},isArray:!0},queryArchived:{method:"GET",params:{status:"archived"},isArray:!0},querySent:{method:"GET",params:{status:"sent"},isArray:!0},messages:{method:"GET",params:{threadId:"@id",itemType:"messages"},isArray:!0},letters:{method:"GET",params:{threadId:"@id",itemType:"letters"},isArray:!0},remove:{method:"DELETE",params:{threadId:"@id"}},archive:{method:"POST",params:{threadId:"@id",action:"archive_thread_request"}}})},exports.Thread.$inject=["$resource","lpWidget"],exports.Message=function(e,t){var r=t.getResolvedPreference("threadSrc");return e(r,{},{markAsRead:{method:"POST",params:{threadId:"@threadId",itemType:"messages",itemId:"@id",action:"read_message_request"}}})},exports.Message.$inject=["$resource","lpWidget"],exports.Letter=function(e,t,r,n){var s=t.getResolvedPreference("letterSrc"),a=e(s,{},{query:{method:"GET",params:{action:"drafts"},isArray:!0},save:{method:"PUT",params:{action:"save",letterId:"@id"}},send:{method:"POST",params:{action:"send",letterId:"@id"}},remove:{method:"DELETE",params:{action:"delete",letterId:"@id"}},respond:{method:"PUT",params:{action:"response",threadId:"@threadId",letterId:"@id"}}});return a.create=function(){return new a({id:n.generateUUID(),sender:r.userId})},a},exports.Letter.$inject=["$resource","lpWidget","lpPortal","lpCoreUtils"]}.call(exports,t,exports,e),!(void 0!==r&&(e.exports=r))},function(e,exports,t){var r;r=function(require,exports){"use strict";exports.AlertsManager=function(e,t){var r=3e3,n=[];this.list=function(){return n},this.push=function(t,s,a){var i=this;i.close(),n.push({type:s||"danger",msg:t}),a!==!1&&e(function(){i.close()},r)},this.close=function(){n=[]}},exports.AlertsManager.$inject=["$timeout","$resource"]}.call(exports,t,exports,e),!(void 0!==r&&(e.exports=r))},function(e,exports,t){var r;r=function(require,exports){"use strict";var e=t(2);exports.Topics=function(){return{loadDefault:function(r){return e.fetch("real/api/to/demo-service").then(function(e){return e.data.topics},function(){var e=t(9);return e.forEach(function(e){e.recipient=r[e.recipient]}),e})}}}}.call(exports,t,exports,e),!(void 0!==r&&(e.exports=r))},function(e,exports,t){var r;r=function(){"use strict";return[{question:"I have a question about Online Banking",preQuestion:"Online Banking Assistance",recipient:0,category:"support"},{question:"I have a question about Mobile Banking",preQuestion:"Mobile Banking Assistance",recipient:1,category:"mobile"},{question:"I have a question about Bill Pay",preQuestion:"Bill Pay Assistance",recipient:0,category:"offer"},{question:"I have a question about Accounts or Payments",preQuestion:"Account or Payment Inquiry",recipient:0,category:"business"},{question:"I have a question about Fee or Interest Charges",preQuestion:"Fee or Interest Charges",recipient:1,category:"mobile"},{question:"I have a question about Loans",preQuestion:"Loan Inquiry",recipient:0,category:"consultancy"},{question:"I have a question about Taxes",preQuestion:"Tax Information",recipient:1,category:"support"},{question:"I have a Transaction Dispute",preQuestion:"Transaction Dispute",recipient:0,category:"support"},{question:"I have a question about Wire Transfer",preQuestion:"Wire Transfer Inquiry",recipient:0,category:"consultancy"},{question:"I have another question",preQuestion:"Other",recipient:1,category:"other"}]}.call(exports,t,exports,e),!(void 0!==r&&(e.exports=r))},function(e,exports,t){var r;r=function(require,exports){"use strict";var e=window.jQuery;exports.MessageController=function(t,r,n,s,a,i,o,d,c,u){t.templatesDir=u.getWidgetBaseUrl(n)+"/templates/",t.alerts=a,t.shared=s,t.categories=n.getPreference("categoryList").split(","),t.MSG_AUTOSAVE_TIMEOUT=500,t.tabs={inbox:{},sent:{},archive:{}},t.modalShown=!1,t.loadThreads=function(n){var d=[],l=[];n&&(s.loading=!0),r.all({active:i.queryActive({},function(e){u.forEach(e,function(e){var t=s.resolveDisplayName(e.otherUser),r=e.subject.split(" - ")[1];e.senderName=t,u.isUndefined(r)||(e.subject=r),e.logoPath=c(t,55,55),e.containsUnread?d.push(e):l.push(e)});var t=s.threads;t.active=d.concat(l),t.unread=d,t.read=l}).$promise,archived:i.queryArchived({},function(t){e.each(t,function(){var e=s.resolveDisplayName(this.otherUser);this.senderName=e,this.logoPath=c(e,55,55),this.status="ARCHIVED"}),s.threads.archived=t}).$promise,sent:i.querySent({},function(t){e.each(t,function(){var e=s.resolveDisplayName(this.otherUser),t=this.subject.split(" - ")[1];this.senderName=e,this.logoPath=c(e,55,55),this.status="SENT",u.isUndefined(t)||(this.subject=t)}),s.threads.sent=t}).$promise,drafts:o.query({},function(r){e.each(r,function(){var e=this.subject&&this.subject.split(" - ")[1];u.isUndefined(e)||(this.subject=e),this.status="DRAFT",this.timestamp=this.updatedDate}),s.draftLetters=r,r.length>0&&(t.modalShown=!0)}).$promise}).then(function(e){s.loading=!1},function(e){s.loading=!1,a.push("SERVICE_UNAVAILABLE","danger",!1)})},t.selectThreadAction=function(n){var a=r.defer();return null!==t.shared.selectedThread&&t.shared.selectedThread.id===n.id?(t.closeContentAction(),a.resolve(),a):("DRAFT"===n.status?(t.closeModal(),t.createEditLetterAction(e.extend({},n)),a.resolve()):(t.shared.selectedThread=n,t.isThreadLoading=!0,i.messages({threadId:n.id}).$promise.then(function(r){t.shared.selectedThread.messages=[],e.each(r,function(e,n){var a=new d(n);a.logoPath=c(s.resolveDisplayName(a.sender),55,55),a.senderName=t.shared.resolveDisplayName(a.sender),"UNREAD"===a.status&&(a.show=!0,a.$markAsRead({threadId:t.shared.selectedThread.id})),e+1===r.length&&(t.shared.selectedThread.lastMessageIdInThread=a.id),t.shared.selectedThread.messages.push(a)}),t.isThreadLoading=!1}),i.letters({threadId:n.id}).$promise.then(function(e){t.shared.selectedThread.draft=null,e.length>0&&(t.shared.selectedThread.draft=new o(e[0]),t.shared.selectedThread.draft.threadId=t.shared.selectedThread.id),a.resolve()})),window.scrollTo(0,0),a)},t.deleteDraft=function(e){"DRAFT"===e.status&&(e.$remove().then(function(){s.removeFromList(s.draftLetters,e)},function(){a.push("DELETE_ERROR","danger",!1)}),t.modalShown=!1)},t.closeContentAction=function(){t.shared.selectedThread=null},t.createEditLetterAction=function(e){null!==e&&void 0!==e&&(t.shared.editLetter=e),t.shared.editLetterInd=!0,t.closeContentAction(),t.tabs.inbox.active=!0},t.showSideContent=function(){return null!==t.shared.selectedThread||t.shared.editLetterInd},t.tabSelected=function(){s.selectedThread=null},t.closeModal=function(){t.modalShown=!1},t.loadThreads(!0),t.$on("refresh",t.loadThreads)},exports.MessageController.$inject=["$scope","$q","lpWidget","SharedData","AlertsManager","Thread","Letter","Message","lpDefaultProfileImage","lpCoreUtils"],exports.CreateLetterController=function(t,r,n,s,a,i,o,d,c,u){var l=c;r.shared=s,r.alertsManager=a,r.availableRecipients=[];var h=l.resolvePortalPlaceholders(i.getPreference("recipientsSrc"));n(h).get().$promise.then(function(t){e.each(t.addresses,function(e,t){var n={address:t};n.name=r.shared.resolveDisplayName(t),r.availableRecipients.push(n)}),r.availableRecipients&&r.availableRecipients.length>0&&u.loadDefault(r.availableRecipients).then(function(e){r.subjects=e||[],r.$apply()})}),null!==r.shared.editLetter?r.letter=r.shared.editLetter:r.letter=d.create();var p=function(e){var t=r.selectedQuestion;t&&("string"==typeof t.recipient&&(e.recipients=[t.recipient]),e.subject=t.preQuestion+" - "+t.question,e.category=t.category),e.timestamp=new Date,e.status="DRAFT"};r.save=function(e,t){p(e),e.$save().then(function(t){s.addToList(s.draftLetters,e),a.push("SAVE_SUCCESSFULLY","success",!0)},function(e){a.push("SAVE_ERROR","danger",!1)}),r.close(t)},r.send=function(e,n){p(e),e.$save().then(function(){e.$send().then(function(r){var n=new o(e);n.status="SENT",n.id=r.threadId,s.addToList(s.threads.sent,n),s.removeFromList(s.draftLetters,e),a.push("SEND_SUCCESSFULLY","success",!0),t.$broadcast("refresh",!1)},function(e){a.push("SEND_ERROR","danger",!1)})}),r.close(n)},r.close=function(e){r.shared.editLetterInd=!1,r.shared.editLetter=null,e.newMessageForm.$setPristine(),e.newMessageForm.submitted=!1}},exports.CreateLetterController.$inject=["$rootScope","$scope","$resource","SharedData","AlertsManager","lpWidget","Thread","Letter","lpCoreUtils","Topics"]}.call(exports,t,exports,e),!(void 0!==r&&(e.exports=r))},function(e,exports,t){var r;r=function(require,exports){"use strict";var e=t(12),r=window.jQuery,n=function(e,t){t.shared&&null!==t.shared.selectedThread&&e.id===t.shared.selectedThread.id&&(t.shared.selectedThread=null)},s=function(e,t,r,s){"DRAFT"===e.status?r.$parent.deleteDraft(e):e.$remove().then(function(s){switch(n(e,r),e.status){case"ARCHIVED":t.removeFromList(t.threads.archived,e);break;case"SENT":t.removeFromList(t.threads.sent,e);break;default:e.containsUnread?t.removeFromList(t.threads.unread,e):t.removeFromList(t.threads.read,e)}r.$emit("refresh",!0)},function(e){s.push("DELETE_ERROR","danger",!1)})};exports.messageList=function(e,t,r,n,a,i){var o=a.getWidgetBaseUrl(n)+"/templates";return{restrict:"E",scope:{title:"@",items:"="},replace:!0,templateUrl:o+"/message-list.html",link:function(n,a,o){var d=function(e){return e?decodeURIComponent(e):i()};n.showList=!0,n.shared=t,n.expandView=!1,n.toggleVisibility=function(){n.showList=!n.showList},n.picture=function(e){return d(e)},n.select=function(e,t){return t.stopPropagation(),n.$parent.selectThreadAction(e)},n.expanded=function(){return n.$parent.showSideContent()},n.expand=function(e){n.index=n.index===e?-1:e},n.selectedItem=function(){return n.shared.selectedThread},n.quickReply=function(t,r){r.stopPropagation(),null===n.shared.selectedThread||n.shared.selectedThread.id!==t.id?n.$parent.selectThreadAction(t).promise.then(function(){e.$broadcast("initiateReply")}):e.$broadcast("initiateReply")},n.quickDelete=function(e){s(e,t,n,r)},n.quickArchive=function(e){e.$archive().then(function(r){e.status="ARCHIVED",e.containsUnread?t.removeFromList(t.threads.unread,e):t.removeFromList(t.threads.read,e),t.addToList(t.threads.archived,e)})}}}},exports.messageList.$inject=["$rootScope","SharedData","AlertsManager","lpWidget","lpCoreUtils","lpDefaultProfileImage"],exports.messageContent=function(e,t,n,a,i,o){var d=i.getWidgetBaseUrl(a)+"/templates";return{restrict:"E",scope:{thread:"="},replace:!0,templateUrl:d+"/message-content.html",link:function(a,i,d){a.replySaveInProgressInd=!1;var c=null;a.$on("initiateReply",function(){a.openReplyAction()}),a.toggleMessageVisibility=function(e){e.isLastInThread||(e.show=!e.show)},a.openReplyAction=function(){null===a.thread.draft&&(a.thread.draft=n.create(),a.thread.draft.threadId=a.thread.id),setTimeout(function(){r("#replyMessageFormBody").focus(),r("#replyMessageFormBody").on("input propertychange",function(){null!==a.thread.draft&&(clearTimeout(c),c=setTimeout(function(){a.saveReplyAction(a.thread.draft)},a.$parent.MSG_AUTOSAVE_TIMEOUT))})},a.$parent.MSG_AUTOSAVE_TIMEOUT)},a.quickDelete=function(e){s(e,o,a,t),a.close(),a.$emit("refresh",!0)},a.cancelReplyAction=function(e){null!==a.thread.draft&&(a.thread.draft.$remove(),a.clearReplyAction(e))},a.clearReplyAction=function(e){a.thread.draft=null,e.replyMessageForm.$setPristine(),e.replyMessageForm.submitted=!1},a.saveReplyAction=function(t){a.replySaveInProgressInd=!0,t.$respond().then(function(t){e(function(){a.replySaveInProgressInd=!1},a.$parent.MSG_AUTOSAVE_TIMEOUT)})},a.sendReplyAction=function(e){e.timestamp=new Date,e.$respond().then(function(r){e.$send().then(function(e){t.push("SEND_SUCCESSFULLY","success",!0)},function(e){t.push("SEND_ERROR","danger",!1)})},function(e){t.push("SEND_ERROR","danger",!1)}),this.clearReplyAction(this),this.close()},a.close=function(){a.thread=null}}}},exports.messageContent.$inject=["$timeout","AlertsManager","Letter","lpWidget","lpCoreUtils","SharedData"],exports.swipe=function(){return{restrict:"A",scope:{},replace:!0,link:function(t,n,s){var a=new e(n[0]);a.on("panleft",function(e){r(this).toggleClass("swipe-on")})}}}}.call(exports,t,exports,e),!(void 0!==r&&(e.exports=r))},function(e,exports){e.exports=s}])});
//# sourceMappingURL=main.js.map